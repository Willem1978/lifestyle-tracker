<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#8b5cf6">
    <title>Lifestyle Score Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .date-navigator { background: white; border-radius: 20px; padding: 15px 25px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; gap: 15px; }
        .date-nav-btn { background: #8b5cf6; color: white; border: none; border-radius: 10px; padding: 10px 18px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .date-nav-btn:hover { background: #7c3aed; transform: scale(1.05); }
        .date-nav-btn:disabled { background: #d1d5db; cursor: not-allowed; transform: scale(1); }
        .current-date { text-align: center; }
        .current-date h2 { font-size: 1.3rem; color: #374151; margin: 0; }
        .current-date p { font-size: 0.85rem; color: #6b7280; margin: 0; }
        .viewing-past { background: #fef3c7; border: 2px solid #f59e0b; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; color: #92400e; font-weight: 600; }
        .scores { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .score-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: all 0.3s; }
        .score-card.today.negative { background: #ef4444; color: white; }
        .score-card.today.neutral { background: #f97316; color: white; }
        .score-card.today.positive { background: #10b981; color: white; }
        .score-card.total { background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); color: white; }
        .score-label { font-size: 0.9rem; opacity: 0.9; margin-bottom: 10px; }
        .score-value { font-size: 3rem; font-weight: bold; }
        .activities { background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .activities h2 { font-size: 1.8rem; margin-bottom: 20px; color: #374151; }
        .activity { border: 2px solid #e5e7eb; border-radius: 15px; padding: 20px; margin-bottom: 20px; transition: all 0.3s; position: relative; }
        .activity.highlighted { border-color: #f59e0b; background: #fffbeb; }
        .activity:hover { border-color: #8b5cf6; }
        .activity-highlight-btn { position: absolute; top: 15px; right: 15px; background: #fef3c7; color: #f59e0b; border: 2px solid #fde68a; border-radius: 50%; width: 35px; height: 35px; font-size: 1rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; padding: 0; }
        .activity-highlight-btn.active { background: #f59e0b; color: white; border-color: #f59e0b; transform: scale(1.1); box-shadow: 0 3px 10px rgba(245, 158, 11, 0.4); }
        .activity-highlight-btn:hover { transform: scale(1.15); }
        .activity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-right: 45px; }
        .activity-name { font-size: 1.1rem; font-weight: 600; color: #374151; }
        .activity-points { padding: 5px 12px; border-radius: 8px; font-weight: bold; font-size: 0.9rem; }
        .points-positive { background: #d1fae5; color: #065f46; }
        .points-negative { background: #fee2e2; color: #991b1b; }
        .points-neutral { background: #f3f4f6; color: #6b7280; }
        .points-highlight { background: #fef3c7; color: #92400e; }
        .activity-buttons { display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: center; }
        .btn { padding: 15px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn:active { transform: scale(0.95); }
        .btn-yes { background: #f3f4f6; color: #6b7280; }
        .btn-yes.active { background: #10b981; color: white; transform: scale(1.05); box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4); }
        .btn-no { background: #f3f4f6; color: #6b7280; }
        .btn-no.active { background: #ef4444; color: white; transform: scale(1.05); box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4); }
        .btn-reset-small { background: #e5e7eb; color: #9ca3af; border: none; border-radius: 8px; width: 40px; height: 40px; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; padding: 0; }
        .btn-reset-small:hover { background: #d1d5db; color: #6b7280; transform: scale(1.05); }
        .chart-container { background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .chart-container h2 { font-size: 1.8rem; margin-bottom: 20px; color: #374151; }
        .bottom-buttons { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; }
        .settings-btn-bottom { padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); border-radius: 15px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .settings-btn-bottom:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }
        .reset-btn { padding: 15px 30px; background: rgba(239, 68, 68, 0.8); color: white; border: none; border-radius: 15px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .reset-btn:hover { background: #dc2626; transform: scale(1.05); }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto; }
        .modal.show { display: block; }
        .modal-content { background: white; margin: 50px auto; padding: 30px; border-radius: 20px; max-width: 600px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .modal-header h2 { font-size: 2rem; color: #374151; }
        .close-btn { background: #ef4444; color: white; border: none; border-radius: 10px; padding: 10px 20px; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .close-btn:hover { background: #dc2626; }
        .category-item { background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .category-item h3 { color: #374151; margin-bottom: 15px; font-size: 1.2rem; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #6b7280; font-weight: 600; margin-bottom: 5px; font-size: 0.9rem; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; }
        .form-group input:focus { outline: none; border-color: #8b5cf6; }
        .category-actions { display: flex; gap: 10px; margin-top: 15px; }
        .delete-category-btn { background: #ef4444; color: white; border: none; border-radius: 8px; padding: 10px 20px; font-weight: 600; cursor: pointer; flex: 1; }
        .delete-category-btn:hover { background: #dc2626; }
        .add-category-btn { background: #10b981; color: white; border: none; border-radius: 12px; padding: 15px 30px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
        .add-category-btn:hover { background: #059669; }
        .save-settings-btn { background: #8b5cf6; color: white; border: none; border-radius: 12px; padding: 15px 30px; font-size: 1.1rem; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
        .save-settings-btn:hover { background: #7c3aed; }
        .app-settings { background: #f0f9ff; border: 2px solid #bae6fd; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .app-settings h3 { color: #0c4a6e; margin-bottom: 15px; font-size: 1.2rem; }
        
        /* Streak counter */
        .streak-banner { background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); border-radius: 15px; padding: 15px 25px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; color: white; font-weight: 600; box-shadow: 0 5px 20px rgba(245, 158, 11, 0.4); }
        .streak-banner.hidden { display: none; }
        .streak-fire { font-size: 1.5rem; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        
        /* Confetti animation */
        .confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        
        /* Week overview */
        .week-overview { background: white; border-radius: 20px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .week-overview h2 { font-size: 1.5rem; margin-bottom: 20px; color: #374151; }
        .week-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 15px; }
        .week-day { text-align: center; padding: 12px 5px; border-radius: 12px; background: #f3f4f6; transition: all 0.3s; }
        .week-day.positive { background: linear-gradient(135deg, #10b981, #34d399); color: white; }
        .week-day.negative { background: linear-gradient(135deg, #ef4444, #f87171); color: white; }
        .week-day.neutral { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; }
        .week-day.today { box-shadow: 0 0 0 3px #8b5cf6; }
        .week-day.future { opacity: 0.4; }
        .week-day-name { font-size: 0.7rem; font-weight: 600; opacity: 0.8; }
        .week-day-score { font-size: 1.1rem; font-weight: bold; margin-top: 5px; }
        .week-day-date { font-size: 0.65rem; opacity: 0.7; margin-top: 2px; }
        .week-summary { display: flex; justify-content: space-around; padding-top: 15px; border-top: 2px solid #f3f4f6; }
        .week-summary-item { text-align: center; }
        .week-summary-value { font-size: 1.3rem; font-weight: bold; color: #8b5cf6; }
        .week-summary-label { font-size: 0.75rem; color: #6b7280; }
        
        /* Badges */
        .badges-container { background: white; border-radius: 20px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .badges-container h2 { font-size: 1.5rem; margin-bottom: 20px; color: #374151; }
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; }
        .badge { text-align: center; padding: 15px 10px; border-radius: 15px; background: #f9fafb; border: 2px solid #e5e7eb; transition: all 0.3s; }
        .badge.earned { background: linear-gradient(135deg, #fef3c7, #fde68a); border-color: #f59e0b; transform: scale(1.05); }
        .badge.earned .badge-icon { filter: none; }
        .badge-icon { font-size: 2rem; margin-bottom: 8px; filter: grayscale(100%); opacity: 0.4; transition: all 0.3s; }
        .badge.earned .badge-icon { filter: none; opacity: 1; }
        .badge-name { font-size: 0.7rem; font-weight: 600; color: #374151; }
        .badge-progress { font-size: 0.6rem; color: #6b7280; margin-top: 4px; }
        .badge.earned .badge-progress { color: #92400e; }
        .badge-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); background: white; padding: 30px 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); z-index: 10000; text-align: center; transition: transform 0.3s ease; }
        .badge-popup.show { transform: translate(-50%, -50%) scale(1); }
        .badge-popup-icon { font-size: 4rem; margin-bottom: 15px; }
        .badge-popup-title { font-size: 1.5rem; font-weight: bold; color: #374151; margin-bottom: 10px; }
        .badge-popup-desc { color: #6b7280; margin-bottom: 20px; }
        .badge-popup-close { background: #8b5cf6; color: white; border: none; padding: 12px 30px; border-radius: 10px; font-weight: 600; cursor: pointer; }
        
        /* Daily motivation */
        .motivation-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 25px; margin-bottom: 30px; color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; overflow: hidden; }
        .motivation-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); }
        .motivation-theme { font-size: 0.8rem; opacity: 0.8; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .motivation-quote { font-size: 1.2rem; font-weight: 600; line-height: 1.5; position: relative; z-index: 1; }
        .motivation-author { font-size: 0.85rem; opacity: 0.8; margin-top: 12px; font-style: italic; }
        .motivation-refresh { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1rem; transition: all 0.3s; }
        .motivation-refresh:hover { background: rgba(255,255,255,0.3); transform: rotate(180deg); }
        
        /* Sound toggle */
        .sound-toggle { position: fixed; bottom: 20px; right: 20px; background: white; border: none; width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 5px 20px rgba(0,0,0,0.2); cursor: pointer; font-size: 1.3rem; z-index: 100; transition: all 0.3s; }
        .sound-toggle:hover { transform: scale(1.1); }
        .sound-toggle.muted { opacity: 0.5; }
        
        @media (max-width: 768px) {
            .scores { grid-template-columns: 1fr 1fr; }
            .header h1 { font-size: 2rem; }
            .score-value { font-size: 2rem; }
            .date-nav-btn { padding: 8px 14px; font-size: 1rem; }
            .current-date h2 { font-size: 1.1rem; }
            .bottom-buttons { flex-direction: column; }
            .week-days { grid-template-columns: repeat(7, 1fr); gap: 5px; }
            .week-day { padding: 8px 3px; }
            .week-day-name { font-size: 0.6rem; }
            .week-day-score { font-size: 0.9rem; }
            .badges-grid { grid-template-columns: repeat(3, 1fr); }
            .motivation-quote { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="appTitle">üéØ Lifestyle Score Tracker</h1>
            <p id="appSubtitle">Bouw aan een beter leven, √©√©n dag tegelijk</p>
        </div>
        
        <div id="streakBanner" class="streak-banner hidden">
            <span class="streak-fire">üî•</span>
            <span id="streakText">3 dagen op rij positief!</span>
            <span class="streak-fire">üî•</span>
        </div>
        
        <div class="date-navigator">
            <button class="date-nav-btn" onclick="navigateDay(-1)">‚óÄ</button>
            <div class="current-date">
                <h2 id="viewingDateDisplay">Vandaag</h2>
                <p id="viewingDateSub"></p>
            </div>
            <button class="date-nav-btn" id="nextDayBtn" onclick="navigateDay(1)">‚ñ∂</button>
        </div>
        
        <div id="viewingPastAlert" class="viewing-past" style="display: none;">
            ‚ö†Ô∏è Je bekijkt een dag uit het verleden. Wijzigingen worden opgeslagen.
        </div>
        
        <div class="scores">
            <div class="score-card today" id="todayCard">
                <div class="score-label" id="dayLabel">üìÖ Vandaag</div>
                <div class="score-value" id="todayScore">-2</div>
            </div>
            <div class="score-card total">
                <div class="score-label">üèÜ Totale Levensscore</div>
                <div class="score-value" id="totalScore">0</div>
            </div>
        </div>
        
        <!-- Daily Motivation -->
        <div class="motivation-card">
            <button class="motivation-refresh" onclick="refreshMotivation()" title="Nieuwe quote">üîÑ</button>
            <div class="motivation-theme" id="motivationTheme">üí™ Discipline</div>
            <div class="motivation-quote" id="motivationQuote">"Succes is de som van kleine inspanningen, dag in dag uit herhaald."</div>
            <div class="motivation-author" id="motivationAuthor">‚Äî Robert Collier</div>
        </div>
        
        <!-- Dagelijkse Activiteiten -->
        <div class="activities">
            <h2>üìä Dagelijkse Activiteiten</h2>
            <div id="activitiesList"></div>
        </div>
        
        <!-- Week Overview -->
        <div class="week-overview">
            <h2>üìÖ Deze Week</h2>
            <div class="week-days" id="weekDays"></div>
            <div class="week-summary">
                <div class="week-summary-item">
                    <div class="week-summary-value" id="weekAverage">0</div>
                    <div class="week-summary-label">Gemiddelde</div>
                </div>
                <div class="week-summary-item">
                    <div class="week-summary-value" id="weekBest">0</div>
                    <div class="week-summary-label">Beste dag</div>
                </div>
                <div class="week-summary-item">
                    <div class="week-summary-value" id="weekTotal">0</div>
                    <div class="week-summary-label">Week totaal</div>
                </div>
            </div>
        </div>
        
        <!-- Badges -->
        <div class="badges-container">
            <h2>üèÖ Badges</h2>
            <div class="badges-grid" id="badgesGrid"></div>
        </div>
        
        <div class="chart-container">
            <h2>üìà Voortgang</h2>
            <canvas id="progressChart"></canvas>
        </div>
        
        <div class="bottom-buttons">
            <button class="settings-btn-bottom" onclick="openSettings()">‚öôÔ∏è Instellingen</button>
            <button class="reset-btn" onclick="resetAll()">üóëÔ∏è Reset Alles</button>
        </div>
    </div>
    
    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()" title="Geluid aan/uit">üîä</button>
    
    <!-- Badge Popup -->
    <div class="badge-popup" id="badgePopup">
        <div class="badge-popup-icon" id="badgePopupIcon">üèÜ</div>
        <div class="badge-popup-title" id="badgePopupTitle">Badge Behaald!</div>
        <div class="badge-popup-desc" id="badgePopupDesc">Je hebt een nieuwe badge verdiend!</div>
        <button class="badge-popup-close" onclick="closeBadgePopup()">Geweldig!</button>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Instellingen</h2>
                <button class="close-btn" onclick="closeSettings()">Sluiten</button>
            </div>
            
            <div class="app-settings">
                <h3>üì± App Instellingen</h3>
                <div class="form-group">
                    <label>Titel</label>
                    <input type="text" id="appTitleInput" placeholder="Lifestyle Score Tracker">
                </div>
                <div class="form-group">
                    <label>Ondertitel</label>
                    <input type="text" id="appSubtitleInput" placeholder="Bouw aan een beter leven, √©√©n dag tegelijk">
                </div>
            </div>
            
            <h3 style="margin-bottom: 15px; color: #374151;">üìã Categorie√´n</h3>
            <div id="categoriesList"></div>
            <button class="add-category-btn" onclick="addNewCategory()">‚ûï Nieuwe Categorie</button>
            <button class="save-settings-btn" onclick="saveSettings()">üíæ Opslaan</button>
        </div>
    </div>

    <script>
        var STORAGE_KEY = 'lifestyle_tracker_advanced_v1';
        var CATEGORIES_KEY = 'lifestyle_categories_v1';
        var SETTINGS_KEY = 'lifestyle_app_settings_v1';
        
        var defaultCategories = [
            { key: 'goodSleep', label: 'Goede Nachtrust', pointsYes: 1, pointsNo: 0 },
            { key: 'sport', label: 'Sporten', pointsYes: 1, pointsNo: 0 },
            { key: 'healthyEating', label: 'Gezond Eten', pointsYes: 1, pointsNo: 0 },
            { key: 'meditation', label: 'Meditatie', pointsYes: 1, pointsNo: 0 },
            { key: 'personalDevelopment', label: 'Persoonlijke Ontwikkeling', pointsYes: 1, pointsNo: 0 },
            { key: 'noAlcohol', label: 'Geen Alcohol', pointsYes: 0, pointsNo: -2 },
            { key: 'noBadBehavior', label: 'Geen Ander Slecht Gedrag', pointsYes: 0, pointsNo: -2 }
        ];
        
        var appSettings = {
            title: 'üéØ Lifestyle Score Tracker',
            subtitle: 'Bouw aan een beter leven, √©√©n dag tegelijk'
        };
        
        var categories = [];
        var state = { days: {}, baseTotalScore: 0, lastDate: null };
        var activities = {};
        var highlights = {};
        var todayScore = -2;
        var totalScore = 0;
        var chart = null;
        var viewingDate = null;
        var tempCategories = [];
        var tempSettings = {};
        var soundEnabled = true;
        var earnedBadges = [];
        
        // Motivatie quotes per thema
        var motivationThemes = {
            discipline: {
                icon: 'üí™',
                name: 'Discipline',
                quotes: [
                    { text: 'Succes is de som van kleine inspanningen, dag in dag uit herhaald.', author: 'Robert Collier' },
                    { text: 'Discipline is de brug tussen doelen en resultaten.', author: 'Jim Rohn' },
                    { text: 'We worden wat we herhaaldelijk doen. Excellentie is geen daad, maar een gewoonte.', author: 'Aristoteles' },
                    { text: 'De pijn van discipline weegt grammen, de pijn van spijt weegt tonnen.', author: 'Jim Rohn' }
                ]
            },
            growth: {
                icon: 'üå±',
                name: 'Groei',
                quotes: [
                    { text: 'Elke meester was ooit een ramp.', author: 'T. Harv Eker' },
                    { text: 'Het maakt niet uit hoe langzaam je gaat, zolang je maar niet stopt.', author: 'Confucius' },
                    { text: 'Groei begint waar je comfortzone eindigt.', author: 'Onbekend' },
                    { text: 'Je hoeft niet geweldig te zijn om te beginnen, maar je moet beginnen om geweldig te worden.', author: 'Zig Ziglar' }
                ]
            },
            mindset: {
                icon: 'üß†',
                name: 'Mindset',
                quotes: [
                    { text: 'Of je denkt dat je het kunt, of je denkt dat je het niet kunt - je hebt altijd gelijk.', author: 'Henry Ford' },
                    { text: 'Je gedachten worden je woorden, je woorden worden je daden.', author: 'Mahatma Gandhi' },
                    { text: 'De enige limiet aan onze realisatie van morgen zijn onze twijfels van vandaag.', author: 'Franklin D. Roosevelt' },
                    { text: 'Verander je gedachten en je verandert je wereld.', author: 'Norman Vincent Peale' }
                ]
            },
            health: {
                icon: '‚ù§Ô∏è',
                name: 'Gezondheid',
                quotes: [
                    { text: 'Zorg goed voor je lichaam. Het is de enige plek waar je moet leven.', author: 'Jim Rohn' },
                    { text: 'Gezondheid is niet alles, maar zonder gezondheid is alles niets.', author: 'Arthur Schopenhauer' },
                    { text: 'Een gezonde geest in een gezond lichaam.', author: 'Juvenalis' },
                    { text: 'De grootste rijkdom is gezondheid.', author: 'Vergilius' }
                ]
            },
            persistence: {
                icon: 'üî•',
                name: 'Doorzettingsvermogen',
                quotes: [
                    { text: 'Vallen is geen falen. Falen is blijven liggen waar je gevallen bent.', author: 'Socrates' },
                    { text: 'Het doet er niet toe hoe vaak je faalt. Je hoeft maar √©√©n keer gelijk te hebben.', author: 'Mark Cuban' },
                    { text: 'Succes is van falen naar falen gaan zonder je enthousiasme te verliezen.', author: 'Winston Churchill' },
                    { text: 'De eik was ooit een nootje dat standhield.', author: 'Onbekend' }
                ]
            },
            happiness: {
                icon: '‚òÄÔ∏è',
                name: 'Geluk',
                quotes: [
                    { text: 'Geluk is geen bestemming, het is een manier van reizen.', author: 'Margaret Lee Runbeck' },
                    { text: 'De gelukkigste mensen hebben niet het beste van alles, ze maken het beste van alles.', author: 'Onbekend' },
                    { text: 'Geluk vermenigvuldigt zich als je het deelt.', author: 'Onbekend' },
                    { text: 'Wees dankbaar voor wat je hebt; je krijgt er meer van.', author: 'Oprah Winfrey' }
                ]
            }
        };
        
        // Badge definities
        var badgeDefinitions = [
            { id: 'first_day', icon: '‚≠ê', name: 'Eerste Stap', desc: 'Eerste dag voltooid', condition: function() { return Object.keys(state.days).length >= 1; } },
            { id: 'week_warrior', icon: 'üóìÔ∏è', name: 'Week Warrior', desc: '7 dagen bijgehouden', condition: function() { return Object.keys(state.days).length >= 7; } },
            { id: 'month_master', icon: 'üìÖ', name: 'Maand Meester', desc: '30 dagen bijgehouden', condition: function() { return Object.keys(state.days).length >= 30; } },
            { id: 'streak_3', icon: 'üî•', name: 'Op Dreef', desc: '3 dagen streak', condition: function() { return getStreak() >= 3; } },
            { id: 'streak_7', icon: 'üí´', name: 'Week Streak', desc: '7 dagen streak', condition: function() { return getStreak() >= 7; } },
            { id: 'streak_30', icon: 'üåü', name: 'Maand Streak', desc: '30 dagen streak', condition: function() { return getStreak() >= 30; } },
            { id: 'perfect_day', icon: 'üíé', name: 'Perfecte Dag', desc: 'Score van 5+', condition: function() { return todayScore >= 5; } },
            { id: 'positive_10', icon: 'üéØ', name: 'Positief', desc: '10 positieve dagen', condition: function() { return countPositiveDays() >= 10; } },
            { id: 'total_50', icon: 'üèÜ', name: 'Halfweg', desc: 'Totaal 50 punten', condition: function() { return totalScore >= 50; } },
            { id: 'total_100', icon: 'üëë', name: 'Kampioen', desc: 'Totaal 100 punten', condition: function() { return totalScore >= 100; } },
            { id: 'early_bird', icon: 'üê¶', name: 'Vroege Vogel', desc: 'Alle vragen voor 9:00', condition: function() { return checkAllAnswered() && new Date().getHours() < 9; } },
            { id: 'comeback', icon: 'üí™', name: 'Comeback', desc: 'Positief na negatieve dag', condition: function() { return checkComeback(); } }
        ];
        
        var BADGES_KEY = 'lifestyle_badges_v1';
        var SOUND_KEY = 'lifestyle_sound_v1';

        function getTodayKey() { 
            var d = new Date(); 
            return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0'); 
        }
        
        function getDateKey(date) { 
            return date.getFullYear() + '-' + String(date.getMonth()+1).padStart(2,'0') + '-' + String(date.getDate()).padStart(2,'0'); 
        }
        
        function parseDateKey(key) { 
            var parts = key.split('-');
            return new Date(parseInt(parts[0]), parseInt(parts[1])-1, parseInt(parts[2])); 
        }
        
        function saveToStorage() { 
            try { 
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); 
                return true; 
            } catch(e) { 
                console.error('Error saving to storage:', e);
                return false; 
            } 
        }
        
        function loadFromStorage() { 
            try { 
                var d = localStorage.getItem(STORAGE_KEY); 
                return d ? JSON.parse(d) : null; 
            } catch(e) { 
                console.error('Error loading from storage:', e);
                return null; 
            } 
        }
        
        function saveCategories() { 
            try { 
                localStorage.setItem(CATEGORIES_KEY, JSON.stringify(categories)); 
            } catch(e) {
                console.error('Error saving categories:', e);
            } 
        }
        
        function loadCategories() { 
            try { 
                var d = localStorage.getItem(CATEGORIES_KEY); 
                return d ? JSON.parse(d) : null; 
            } catch(e) { 
                console.error('Error loading categories:', e);
                return null; 
            } 
        }
        
        function saveAppSettings() { 
            try { 
                localStorage.setItem(SETTINGS_KEY, JSON.stringify(appSettings)); 
            } catch(e) {
                console.error('Error saving app settings:', e);
            } 
        }
        
        function loadAppSettings() { 
            try { 
                var d = localStorage.getItem(SETTINGS_KEY); 
                return d ? JSON.parse(d) : null; 
            } catch(e) { 
                console.error('Error loading app settings:', e);
                return null; 
            } 
        }
        
        function navigateDay(offset) {
            var currentDate = viewingDate ? parseDateKey(viewingDate) : new Date();
            currentDate.setDate(currentDate.getDate() + offset);
            var newDateKey = getDateKey(currentDate);
            var today = getTodayKey();
            
            if (newDateKey > today) return;
            
            viewingDate = newDateKey === today ? null : newDateKey;
            loadDayData(viewingDate || today);
            updateUI();
            updateNavigationUI();
        }
        
        function updateNavigationUI() {
            var today = getTodayKey();
            var isToday = !viewingDate || viewingDate === today;
            var nextBtn = document.getElementById('nextDayBtn');
            
            if (nextBtn) {
                nextBtn.disabled = isToday;
            }
            
            if (isToday) {
                document.getElementById('viewingDateDisplay').textContent = 'Vandaag';
                document.getElementById('viewingDateSub').textContent = formatDateNice(new Date());
                document.getElementById('viewingPastAlert').style.display = 'none';
                document.getElementById('dayLabel').textContent = 'üìÖ Vandaag';
            } else {
                var date = parseDateKey(viewingDate);
                var todayDate = new Date();
                todayDate.setHours(0, 0, 0, 0);
                date.setHours(0, 0, 0, 0);
                var daysAgo = Math.round((todayDate - date) / (1000 * 60 * 60 * 24));
                
                if (daysAgo === 1) {
                    document.getElementById('viewingDateDisplay').textContent = 'Gisteren';
                } else {
                    document.getElementById('viewingDateDisplay').textContent = formatDateNice(date);
                }
                document.getElementById('viewingDateSub').textContent = daysAgo + ' ' + (daysAgo === 1 ? 'dag' : 'dagen') + ' geleden';
                document.getElementById('viewingPastAlert').style.display = 'block';
                document.getElementById('dayLabel').textContent = 'üìÖ Deze Dag';
            }
        }
        
        function formatDateNice(date) {
            var dagen = ['zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag'];
            var maanden = ['januari', 'februari', 'maart', 'april', 'mei', 'juni', 'juli', 'augustus', 'september', 'oktober', 'november', 'december'];
            return dagen[date.getDay()] + ' ' + date.getDate() + ' ' + maanden[date.getMonth()];
        }
        
        function loadDayData(dateKey) {
            var dayData = state.days[dateKey];
            
            var newActivities = {};
            var newHighlights = {};
            
            for (var i = 0; i < categories.length; i++) {
                var c = categories[i];
                newActivities[c.key] = null;
                newHighlights[c.key] = false;
            }
            
            if (dayData) {
                for (var i = 0; i < categories.length; i++) {
                    var c = categories[i];
                    if (dayData.activities && dayData.activities[c.key] !== undefined) {
                        newActivities[c.key] = dayData.activities[c.key];
                    }
                    if (dayData.highlights && dayData.highlights[c.key] !== undefined) {
                        newHighlights[c.key] = dayData.highlights[c.key];
                    }
                }
                todayScore = dayData.score;
            } else {
                todayScore = -2;
            }
            
            activities = newActivities;
            highlights = newHighlights;
        }

        function initializeApp() {
            var savedCats = loadCategories();
            if (savedCats && savedCats.length > 0) {
                categories = savedCats;
            } else {
                categories = JSON.parse(JSON.stringify(defaultCategories));
            }
            
            var savedSettings = loadAppSettings();
            if (savedSettings) {
                appSettings = savedSettings;
            }
            
            document.getElementById('appTitle').textContent = appSettings.title;
            document.getElementById('appSubtitle').textContent = appSettings.subtitle;
            
            var saved = loadFromStorage();
            if (saved) {
                state = saved;
            } else {
                state = { days: {}, baseTotalScore: 0, lastDate: null };
            }

            var today = getTodayKey();
            var last = state.lastDate;
            
            if (last && last !== today) {
                var yesterdayData = state.days[last];
                if (yesterdayData) {
                    state.baseTotalScore += yesterdayData.score;
                }
                state.lastDate = today;
                saveToStorage();
            }
            
            viewingDate = null;
            
            var todayData = state.days[today];
            if (todayData) { 
                loadDayData(today);
            } else {
                activities = {};
                highlights = {};
                for (var i = 0; i < categories.length; i++) {
                    var c = categories[i];
                    activities[c.key] = null;
                    highlights[c.key] = false;
                }
                todayScore = -2;
                state.days[today] = { 
                    date: today, 
                    activities: JSON.parse(JSON.stringify(activities)), 
                    highlights: JSON.parse(JSON.stringify(highlights)), 
                    score: todayScore 
                };
                state.lastDate = today;
                saveToStorage();
            }
            
            totalScore = state.baseTotalScore + todayScore;
            
            // Laad badges
            earnedBadges = loadBadges();
            
            // Laad geluidsinstellingen
            soundEnabled = loadSoundSetting();
            var soundBtn = document.getElementById('soundToggle');
            if (soundBtn) {
                soundBtn.textContent = soundEnabled ? 'üîä' : 'üîá';
                soundBtn.classList.toggle('muted', !soundEnabled);
            }
            
            // Laad random motivatie quote
            refreshMotivation();
            
            updateNavigationUI();
            updateUI();
        }

        function calculateScore() {
            var s = -2;
            for (var i = 0; i < categories.length; i++) {
                var c = categories[i];
                var v = activities[c.key];
                var h = highlights[c.key];
                var multiplier = h ? 2 : 1;
                
                if (v === true) {
                    s += c.pointsYes * multiplier;
                } else if (v === false) {
                    s += c.pointsNo * multiplier;
                }
            }
            return s;
        }

        function handleClick(key, val) {
            var wasAllAnswered = checkAllAnswered();
            
            activities[key] = val;
            todayScore = calculateScore();
            
            var dateToUpdate = viewingDate || getTodayKey();
            state.days[dateToUpdate] = { 
                date: dateToUpdate, 
                activities: JSON.parse(JSON.stringify(activities)), 
                highlights: JSON.parse(JSON.stringify(highlights)), 
                score: todayScore 
            };
            
            recalculateTotalScore();
            saveToStorage();
            
            // Geluid afspelen
            if (val === true) {
                playSound('success');
            } else {
                playSound('negative');
            }
            
            updateUI();
            
            // Confetti bij alle vragen beantwoord en positieve score
            var isAllAnswered = checkAllAnswered();
            if (!wasAllAnswered && isAllAnswered && todayScore > 0) {
                triggerConfetti();
            }
        }
        
        function checkAllAnswered() {
            for (var i = 0; i < categories.length; i++) {
                if (activities[categories[i].key] === null) {
                    return false;
                }
            }
            return true;
        }
        
        function toggleHighlight(key) {
            highlights[key] = !highlights[key];
            todayScore = calculateScore();
            
            var dateToUpdate = viewingDate || getTodayKey();
            state.days[dateToUpdate] = { 
                date: dateToUpdate, 
                activities: JSON.parse(JSON.stringify(activities)), 
                highlights: JSON.parse(JSON.stringify(highlights)), 
                score: todayScore 
            };
            
            recalculateTotalScore();
            saveToStorage();
            playSound('click');
            updateUI();
        }
        
        function recalculateTotalScore() {
            var today = getTodayKey();
            var sortedDates = Object.keys(state.days).sort();
            var runningTotal = 0;
            
            for (var i = 0; i < sortedDates.length; i++) {
                var d = sortedDates[i];
                if (d < today) {
                    runningTotal += state.days[d].score;
                }
            }
            
            state.baseTotalScore = runningTotal;
            var todayData = state.days[today];
            totalScore = state.baseTotalScore + (todayData ? todayData.score : -2);
        }

        function updateUI() {
            document.getElementById('todayScore').textContent = (todayScore > 0 ? '+' : '') + todayScore;
            document.getElementById('totalScore').textContent = (totalScore > 0 ? '+' : '') + totalScore;
            
            var tc = document.getElementById('todayCard');
            tc.classList.remove('negative', 'neutral', 'positive');
            if (todayScore < 0) {
                tc.classList.add('negative');
            } else if (todayScore === 0) {
                tc.classList.add('neutral');
            } else {
                tc.classList.add('positive');
            }
            
            updateStreak();
            updateWeekOverview();
            updateBadges();
            updateActivitiesList();
            updateChart();
        }
        
        // Week Overview
        function updateWeekOverview() {
            var today = new Date();
            var dayOfWeek = today.getDay();
            var mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            var monday = new Date(today);
            monday.setDate(today.getDate() + mondayOffset);
            
            var weekDaysHtml = '';
            var dayNames = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo'];
            var weekScores = [];
            var todayKey = getTodayKey();
            
            for (var i = 0; i < 7; i++) {
                var currentDay = new Date(monday);
                currentDay.setDate(monday.getDate() + i);
                var dateKey = getDateKey(currentDay);
                var dayData = state.days[dateKey];
                var score = dayData ? dayData.score : null;
                var isFuture = dateKey > todayKey;
                var isToday = dateKey === todayKey;
                
                var statusClass = '';
                if (isFuture) {
                    statusClass = 'future';
                } else if (score !== null) {
                    if (score > 0) statusClass = 'positive';
                    else if (score < 0) statusClass = 'negative';
                    else statusClass = 'neutral';
                    weekScores.push(score);
                }
                if (isToday) statusClass += ' today';
                
                var displayScore = isFuture ? '-' : (score !== null ? (score > 0 ? '+' + score : score) : '-');
                var displayDate = currentDay.getDate();
                
                weekDaysHtml += '<div class="week-day ' + statusClass + '" onclick="navigateToDate(\'' + dateKey + '\')">' +
                    '<div class="week-day-name">' + dayNames[i] + '</div>' +
                    '<div class="week-day-score">' + displayScore + '</div>' +
                    '<div class="week-day-date">' + displayDate + '</div>' +
                '</div>';
            }
            
            document.getElementById('weekDays').innerHTML = weekDaysHtml;
            
            // Week summary
            var weekTotal = 0;
            var weekBest = null;
            for (var j = 0; j < weekScores.length; j++) {
                weekTotal += weekScores[j];
                if (weekBest === null || weekScores[j] > weekBest) {
                    weekBest = weekScores[j];
                }
            }
            var weekAverage = weekScores.length > 0 ? (weekTotal / weekScores.length).toFixed(1) : '0';
            
            document.getElementById('weekAverage').textContent = weekAverage;
            document.getElementById('weekBest').textContent = weekBest !== null ? (weekBest > 0 ? '+' + weekBest : weekBest) : '-';
            document.getElementById('weekTotal').textContent = weekTotal > 0 ? '+' + weekTotal : weekTotal;
        }
        
        function navigateToDate(dateKey) {
            var todayKey = getTodayKey();
            if (dateKey > todayKey) return;
            
            viewingDate = dateKey === todayKey ? null : dateKey;
            loadDayData(viewingDate || todayKey);
            updateUI();
            updateNavigationUI();
            playSound('click');
        }
        
        // Badges
        function getStreak() {
            var sortedDates = Object.keys(state.days).sort().reverse();
            var streak = 0;
            for (var i = 0; i < sortedDates.length; i++) {
                var dayData = state.days[sortedDates[i]];
                if (dayData && dayData.score > 0) {
                    streak++;
                } else {
                    break;
                }
            }
            return streak;
        }
        
        function countPositiveDays() {
            var count = 0;
            var days = Object.keys(state.days);
            for (var i = 0; i < days.length; i++) {
                if (state.days[days[i]].score > 0) count++;
            }
            return count;
        }
        
        function checkComeback() {
            var sortedDates = Object.keys(state.days).sort().reverse();
            if (sortedDates.length < 2) return false;
            var today = state.days[sortedDates[0]];
            var yesterday = state.days[sortedDates[1]];
            return today && yesterday && today.score > 0 && yesterday.score < 0;
        }
        
        function updateBadges() {
            var grid = document.getElementById('badgesGrid');
            var html = '';
            
            for (var i = 0; i < badgeDefinitions.length; i++) {
                var badge = badgeDefinitions[i];
                var isEarned = earnedBadges.indexOf(badge.id) !== -1;
                var justEarned = false;
                
                // Check if badge should be earned
                if (!isEarned && badge.condition()) {
                    earnedBadges.push(badge.id);
                    saveBadges();
                    isEarned = true;
                    justEarned = true;
                    showBadgePopup(badge);
                }
                
                html += '<div class="badge ' + (isEarned ? 'earned' : '') + '">' +
                    '<div class="badge-icon">' + badge.icon + '</div>' +
                    '<div class="badge-name">' + badge.name + '</div>' +
                    '<div class="badge-progress">' + (isEarned ? '‚úì Behaald' : badge.desc) + '</div>' +
                '</div>';
            }
            
            grid.innerHTML = html;
        }
        
        function showBadgePopup(badge) {
            document.getElementById('badgePopupIcon').textContent = badge.icon;
            document.getElementById('badgePopupTitle').textContent = badge.name + ' Behaald!';
            document.getElementById('badgePopupDesc').textContent = badge.desc;
            document.getElementById('badgePopup').classList.add('show');
            playSound('badge');
            triggerConfetti();
        }
        
        function closeBadgePopup() {
            document.getElementById('badgePopup').classList.remove('show');
            playSound('click');
        }
        
        function saveBadges() {
            try {
                localStorage.setItem(BADGES_KEY, JSON.stringify(earnedBadges));
            } catch(e) {}
        }
        
        function loadBadges() {
            try {
                var saved = localStorage.getItem(BADGES_KEY);
                return saved ? JSON.parse(saved) : [];
            } catch(e) {
                return [];
            }
        }
        
        // Motivatie
        function refreshMotivation() {
            var themes = Object.keys(motivationThemes);
            var randomTheme = themes[Math.floor(Math.random() * themes.length)];
            var theme = motivationThemes[randomTheme];
            var randomQuote = theme.quotes[Math.floor(Math.random() * theme.quotes.length)];
            
            document.getElementById('motivationTheme').innerHTML = theme.icon + ' ' + theme.name;
            document.getElementById('motivationQuote').textContent = '"' + randomQuote.text + '"';
            document.getElementById('motivationAuthor').textContent = '‚Äî ' + randomQuote.author;
            
            playSound('click');
        }
        
        // Geluiden
        function playSound(type) {
            if (!soundEnabled) return;
            
            var audioContext;
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch(e) {
                return;
            }
            
            var oscillator = audioContext.createOscillator();
            var gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'click':
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                case 'success':
                    oscillator.frequency.value = 523;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    oscillator.start(audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    oscillator.stop(audioContext.currentTime + 0.4);
                    break;
                case 'negative':
                    oscillator.frequency.value = 300;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    oscillator.start(audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(250, audioContext.currentTime + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'badge':
                    oscillator.frequency.value = 440;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    oscillator.start(audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(554, audioContext.currentTime + 0.15);
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.3);
                    oscillator.frequency.setValueAtTime(880, audioContext.currentTime + 0.45);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.7);
                    oscillator.stop(audioContext.currentTime + 0.7);
                    break;
            }
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            var btn = document.getElementById('soundToggle');
            btn.textContent = soundEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('muted', !soundEnabled);
            try {
                localStorage.setItem(SOUND_KEY, JSON.stringify(soundEnabled));
            } catch(e) {}
            if (soundEnabled) playSound('click');
        }
        
        function loadSoundSetting() {
            try {
                var saved = localStorage.getItem(SOUND_KEY);
                return saved !== null ? JSON.parse(saved) : true;
            } catch(e) {
                return true;
            }
        }
        
        function updateStreak() {
            var sortedDates = Object.keys(state.days).sort().reverse();
            var streak = 0;
            
            for (var i = 0; i < sortedDates.length; i++) {
                var dayData = state.days[sortedDates[i]];
                if (dayData && dayData.score > 0) {
                    streak++;
                } else {
                    break;
                }
            }
            
            var banner = document.getElementById('streakBanner');
            var text = document.getElementById('streakText');
            
            if (streak >= 2) {
                banner.classList.remove('hidden');
                text.textContent = streak + ' dagen op rij positief!';
            } else {
                banner.classList.add('hidden');
            }
        }
        
        function triggerConfetti() {
            var colors = ['#8b5cf6', '#ec4899', '#10b981', '#f59e0b', '#ef4444'];
            var container = document.createElement('div');
            container.className = 'confetti';
            document.body.appendChild(container);
            
            for (var i = 0; i < 50; i++) {
                var confetti = document.createElement('div');
                confetti.style.cssText = 'position:absolute;width:10px;height:10px;background:' + colors[Math.floor(Math.random() * colors.length)] + ';left:' + Math.random() * 100 + '%;top:-10px;border-radius:50%;animation:fall ' + (Math.random() * 2 + 2) + 's linear forwards;';
                container.appendChild(confetti);
            }
            
            var style = document.createElement('style');
            style.textContent = '@keyframes fall { to { top: 100vh; transform: rotate(' + (Math.random() * 720) + 'deg); opacity: 0; } }';
            document.head.appendChild(style);
            
            setTimeout(function() {
                container.remove();
                style.remove();
            }, 4000);
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateActivitiesList() {
            var listEl = document.getElementById('activitiesList');
            if (!listEl) return;
            
            var html = '';
            for (var i = 0; i < categories.length; i++) {
                var c = categories[i];
                var v = activities[c.key];
                var h = highlights[c.key] || false;
                var multiplier = h ? 2 : 1;
                
                var dp = '0';
                var pc = 'points-neutral';
                
                if (v === true) {
                    var pts = c.pointsYes * multiplier;
                    dp = pts > 0 ? '+' + pts : '0';
                    pc = pts > 0 ? (h ? 'points-highlight' : 'points-positive') : 'points-neutral';
                } else if (v === false) {
                    var pts = c.pointsNo * multiplier;
                    dp = pts < 0 ? '' + pts : '0';
                    pc = pts < 0 ? (h ? 'points-highlight' : 'points-negative') : 'points-neutral';
                }
                
                html += '<div class="activity ' + (h ? 'highlighted' : '') + '">' +
                    '<button class="activity-highlight-btn ' + (h ? 'active' : '') + '" onclick="toggleHighlight(\'' + c.key + '\')" title="Markeer als belangrijk (2x punten)">‚≠ê</button>' +
                    '<div class="activity-header">' +
                        '<div class="activity-name">' + escapeHtml(c.label) + '</div>' +
                        '<div class="activity-points ' + pc + '">' + dp + '</div>' +
                    '</div>' +
                    '<div class="activity-buttons">' +
                        '<button class="btn btn-yes ' + (v === true ? 'active' : '') + '" onclick="handleClick(\'' + c.key + '\', true)">JA ‚úì</button>' +
                        '<button class="btn btn-no ' + (v === false ? 'active' : '') + '" onclick="handleClick(\'' + c.key + '\', false)">NEE ‚úó</button>' +
                        '<button class="btn-reset-small" onclick="resetActivity(\'' + c.key + '\')" title="Reset">‚Ü∫</button>' +
                    '</div>' +
                '</div>';
            }
            listEl.innerHTML = html;
        }

        function updateChart() {
            var hist = [];
            var sortedDates = Object.keys(state.days).sort();
            var runningTotal = 0;
            var today = getTodayKey();
            
            for (var i = 0; i < sortedDates.length; i++) {
                var d = sortedDates[i];
                if (d !== today) {
                    runningTotal += state.days[d].score;
                }
                var t = d === today ? state.baseTotalScore + state.days[d].score : runningTotal;
                hist.push({ date: d, total: t, daily: state.days[d].score });
            }
            
            var ctx = document.getElementById('progressChart');
            if (!ctx) return;
            
            if (chart) {
                chart.destroy();
            }
            
            if (hist.length > 0) {
                var last30 = hist.slice(-30);
                var labels = [];
                var data = [];
                
                for (var i = 0; i < last30.length; i++) {
                    var p = last30[i].date.split('-');
                    labels.push(p[2] + '/' + p[1]);
                    data.push(last30[i].total);
                }
                
                chart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Totale Score',
                            data: data,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(v) { return Math.round(v); }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function openSettings() {
            tempCategories = JSON.parse(JSON.stringify(categories));
            tempSettings = JSON.parse(JSON.stringify(appSettings));
            document.getElementById('appTitleInput').value = tempSettings.title;
            document.getElementById('appSubtitleInput').value = tempSettings.subtitle;
            renderCategoriesSettings();
            document.getElementById('settingsModal').classList.add('show');
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }
        
        function renderCategoriesSettings() {
            var html = '';
            for (var i = 0; i < tempCategories.length; i++) {
                var c = tempCategories[i];
                html += '<div class="category-item">' +
                    '<h3>Categorie ' + (i + 1) + '</h3>' +
                    '<div class="form-group">' +
                        '<label>Naam</label>' +
                        '<input type="text" value="' + escapeHtml(c.label) + '" onchange="updateTempCategory(' + i + ', \'label\', this.value)">' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>Punten bij JA</label>' +
                        '<input type="number" value="' + c.pointsYes + '" onchange="updateTempCategory(' + i + ', \'pointsYes\', parseInt(this.value) || 0)">' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>Punten bij NEE</label>' +
                        '<input type="number" value="' + c.pointsNo + '" onchange="updateTempCategory(' + i + ', \'pointsNo\', parseInt(this.value) || 0)">' +
                    '</div>' +
                    '<div class="category-actions">' +
                        '<button class="delete-category-btn" onclick="deleteTempCategory(' + i + ')">üóëÔ∏è Verwijderen</button>' +
                    '</div>' +
                '</div>';
            }
            document.getElementById('categoriesList').innerHTML = html;
        }
        
        function updateTempCategory(index, field, value) {
            if (tempCategories[index]) {
                tempCategories[index][field] = value;
            }
        }
        
        function deleteTempCategory(index) {
            if (tempCategories.length <= 1) {
                alert('Je moet minimaal √©√©n categorie hebben!');
                return;
            }
            if (confirm('Weet je zeker dat je deze categorie wilt verwijderen?')) {
                tempCategories.splice(index, 1);
                renderCategoriesSettings();
            }
        }
        
        function addNewCategory() {
            var newKey = 'custom_' + Date.now();
            tempCategories.push({
                key: newKey,
                label: 'Nieuwe Categorie',
                pointsYes: 1,
                pointsNo: 0
            });
            renderCategoriesSettings();
        }
        
        function saveSettings() {
            var validCategories = [];
            for (var i = 0; i < tempCategories.length; i++) {
                if (tempCategories[i].label && tempCategories[i].label.trim() !== '') {
                    validCategories.push(tempCategories[i]);
                }
            }
            
            if (validCategories.length === 0) {
                alert('Je moet minimaal √©√©n categorie met een naam hebben!');
                return;
            }
            
            categories = JSON.parse(JSON.stringify(validCategories));
            saveCategories();
            
            appSettings.title = document.getElementById('appTitleInput').value.trim() || 'üéØ Lifestyle Score Tracker';
            appSettings.subtitle = document.getElementById('appSubtitleInput').value.trim() || 'Bouw aan een beter leven, √©√©n dag tegelijk';
            saveAppSettings();
            
            document.getElementById('appTitle').textContent = appSettings.title;
            document.getElementById('appSubtitle').textContent = appSettings.subtitle;
            
            for (var i = 0; i < categories.length; i++) {
                var c = categories[i];
                if (activities[c.key] === undefined) {
                    activities[c.key] = null;
                }
                if (highlights[c.key] === undefined) {
                    highlights[c.key] = false;
                }
            }
            
            todayScore = calculateScore();
            var dateToUpdate = viewingDate || getTodayKey();
            state.days[dateToUpdate] = { 
                date: dateToUpdate, 
                activities: JSON.parse(JSON.stringify(activities)), 
                highlights: JSON.parse(JSON.stringify(highlights)), 
                score: todayScore 
            };
            recalculateTotalScore();
            saveToStorage();
            
            closeSettings();
            updateUI();
            alert('‚úÖ Instellingen opgeslagen!');
        }
        
        function resetActivity(key) {
            activities[key] = null;
            highlights[key] = false;
            todayScore = calculateScore();
            
            var dateToUpdate = viewingDate || getTodayKey();
            state.days[dateToUpdate] = { 
                date: dateToUpdate, 
                activities: JSON.parse(JSON.stringify(activities)), 
                highlights: JSON.parse(JSON.stringify(highlights)), 
                score: todayScore 
            };
            
            recalculateTotalScore();
            saveToStorage();
            updateUI();
        }

        function resetAll() {
            if (confirm('Weet je zeker dat je ALLE data wilt resetten?\n\nDit verwijdert al je voortgang en kan niet ongedaan worden gemaakt!')) {
                try { 
                    localStorage.removeItem(STORAGE_KEY); 
                } catch(e) {
                    console.error('Error removing storage:', e);
                }
                
                state = { days: {}, baseTotalScore: 0, lastDate: getTodayKey() };
                activities = {};
                highlights = {};
                for (var i = 0; i < categories.length; i++) {
                    var c = categories[i];
                    activities[c.key] = null;
                    highlights[c.key] = false;
                }
                todayScore = -2;
                totalScore = -2;
                viewingDate = null;
                
                state.days[getTodayKey()] = { 
                    date: getTodayKey(), 
                    activities: JSON.parse(JSON.stringify(activities)), 
                    highlights: JSON.parse(JSON.stringify(highlights)), 
                    score: todayScore 
                };
                
                saveToStorage(); 
                updateNavigationUI();
                updateUI(); 
                alert('üîÑ Alle data is gereset!');
            }
        }

        // Start de app
        initializeApp();
        
        // Sluit modal bij klikken buiten de content
        document.getElementById('settingsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettings();
            }
        });
    </script>
</body>
</html>
