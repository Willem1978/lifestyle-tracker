<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6366f1">
    <title>Lifestyle Tracker</title>
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Lifestyle Tracker&quot;,&quot;short_name&quot;:&quot;Lifestyle&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%236366f1&quot;,&quot;theme_color&quot;:&quot;%236366f1&quot;}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #a5b4fc;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --success-light: #ecfdf5;
            --warning: #f59e0b;
            --warning-light: #fffbeb;
            --danger: #ef4444;
            --danger-light: #fef2f2;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --radius: 20px;
            --radius-sm: 12px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.12);
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(160deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            min-height: 100vh; 
            padding: 20px 16px;
            padding-bottom: 120px;
        }

        .container { 
            max-width: 420px; 
            margin: 0 auto; 
        }

        /* Header */
        .header { 
            text-align: center; 
            color: white; 
            margin-bottom: 24px;
            padding: 12px 0;
        }
        .header h1 { 
            font-size: 1.625rem; 
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }
        .header p {
            font-size: 0.875rem;
            opacity: 0.8;
            font-weight: 400;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 14px;
            box-shadow: var(--shadow);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .card-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-icon {
            width: 20px;
            height: 20px;
            stroke: var(--primary);
            stroke-width: 2;
            fill: none;
        }

        /* Score Cards */
        .scores {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-bottom: 14px;
        }
        .score-card {
            background: white;
            border-radius: var(--radius);
            padding: 24px 16px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        .score-card.today { background: white; }
        .score-card.today.negative { background: linear-gradient(145deg, #fef2f2, #fee2e2); }
        .score-card.today.negative .score-value { color: var(--danger); }
        .score-card.today.neutral { background: linear-gradient(145deg, #fffbeb, #fef3c7); }
        .score-card.today.neutral .score-value { color: var(--warning); }
        .score-card.today.positive { background: linear-gradient(145deg, #ecfdf5, #d1fae5); }
        .score-card.today.positive .score-value { color: var(--success); }
        .score-card.total { background: linear-gradient(145deg, #eef2ff, #e0e7ff); }
        .score-card.total .score-value { color: var(--primary); }
        .score-label { 
            font-size: 0.7rem; 
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .score-card.today.negative .score-label,
        .score-card.today.neutral .score-label,
        .score-card.today.positive .score-label { color: var(--gray-600); }
        .score-card.total .score-label { color: var(--primary-dark); opacity: 0.7; }
        .score-value { 
            font-size: 2.5rem; 
            font-weight: 800;
            line-height: 1;
            color: var(--gray-400);
            transition: transform 0.3s ease;
        }
        .score-value.bump {
            animation: scoreBump 0.4s ease;
        }
        .score-value.bump-up {
            animation: scoreBumpUp 0.4s ease;
        }
        .score-value.bump-down {
            animation: scoreBumpDown 0.4s ease;
        }
        @keyframes scoreBump {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        @keyframes scoreBumpUp {
            0% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.2) translateY(-5px); }
            100% { transform: scale(1) translateY(0); }
        }
        @keyframes scoreBumpDown {
            0% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.2) translateY(5px); }
            100% { transform: scale(1) translateY(0); }
        }

        /* Daily Goal */
        .daily-goal {
            background: white;
            border-radius: var(--radius);
            padding: 16px 20px;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: var(--shadow);
        }
        .daily-goal-icon { 
            font-size: 1.75rem;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--warning-light);
            border-radius: 14px;
        }
        .daily-goal-text { flex: 1; }
        .daily-goal-title { font-weight: 600; color: var(--gray-800); font-size: 0.95rem; }
        .daily-goal-sub { font-size: 0.8rem; color: var(--gray-500); margin-top: 2px; }
        .daily-goal-progress {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.75rem;
            color: var(--gray-600);
            position: relative;
        }
        .daily-goal-progress::before {
            content: '';
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            position: absolute;
            z-index: 1;
        }
        .daily-goal-progress span { position: relative; z-index: 2; }

        /* Level System */
        .level-card {
            background: linear-gradient(145deg, #6366f1, #8b5cf6);
            color: white;
            padding: 18px 20px;
        }
        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }
        .level-badge {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            backdrop-filter: blur(4px);
        }
        .level-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .xp-help-btn {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.15);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: var(--transition);
        }
        .xp-help-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.1);
        }
        .level-xp {
            font-size: 0.8rem;
            opacity: 0.85;
            margin-top: 4px;
        }
        .level-progress {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        .level-progress-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Streak Banner */
        .streak-banner {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            border-radius: var(--radius);
            padding: 14px 20px;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        .streak-banner.hidden { display: none; }
        .streak-fire { animation: pulse 1s infinite; font-size: 1.2rem; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        /* Personal Records */
        .records {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        .record {
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            padding: 12px 8px;
            text-align: center;
        }
        .record-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }
        .record-label {
            font-size: 0.65rem;
            color: var(--gray-500);
            margin-top: 2px;
        }

        /* Day Navigator */
        .day-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 16px;
        }
        .day-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: white;
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .day-nav-btn:hover { transform: scale(1.05); box-shadow: var(--shadow); }
        .day-nav-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
        .day-nav-current {
            text-align: center;
            color: white;
        }
        .day-nav-date {
            font-size: 1.1rem;
            font-weight: 600;
        }
        .day-nav-sub {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* Quick Entry - Horizontal Toggles */
        .quick-entry {
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, opacity 0.3s ease;
            touch-action: pan-y;
        }
        .quick-entry.swipe-left {
            animation: swipeLeft 0.3s ease;
        }
        .quick-entry.swipe-right {
            animation: swipeRight 0.3s ease;
        }
        @keyframes swipeLeft {
            0% { transform: translateX(0); opacity: 1; }
            50% { transform: translateX(-30px); opacity: 0.5; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes swipeRight {
            0% { transform: translateX(0); opacity: 1; }
            50% { transform: translateX(30px); opacity: 0.5; }
            100% { transform: translateX(0); opacity: 1; }
        }
        .entry-item {
            display: flex;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--gray-100);
        }
        .entry-item:last-child { border-bottom: none; }
        .entry-item.highlighted {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            margin: 0 -20px;
            padding: 16px 20px;
            border-radius: var(--radius-sm);
            border-bottom: none;
        }
        .entry-item.highlighted + .entry-item {
            border-top: 1px solid var(--gray-100);
        }
        .highlight-btn {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 2px solid var(--gray-200);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            margin-left: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .highlight-btn:hover {
            border-color: var(--warning);
            transform: scale(1.08);
        }
        .highlight-btn.active {
            background: linear-gradient(145deg, #f59e0b, #fbbf24);
            border-color: transparent;
            box-shadow: 0 3px 12px rgba(245, 158, 11, 0.35);
        }
        
        /* Mood Section */
        .mood-section {
            margin-bottom: 4px;
            padding-bottom: 18px;
            border-bottom: 1px solid var(--gray-100);
        }
        .mood-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-600);
            margin-bottom: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .mood-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .mood-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .mood-label {
            font-size: 0.9rem;
            color: var(--gray-600);
        }
        .mood-buttons {
            display: flex;
            gap: 12px;
        }
        .mood-btn {
            background: none;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            padding: 0;
            width: 32px;
            height: 32px;
        }
        .mood-btn svg {
            width: 100%;
            height: 100%;
        }
        .mood-btn:hover {
            transform: scale(1.15);
        }
        .mood-btn.good {
            color: var(--success);
            opacity: 1;
        }
        .mood-btn.neutral {
            color: var(--warning);
            opacity: 1;
        }
        .mood-btn.bad {
            color: var(--danger);
            opacity: 1;
        }
        /* Wanneer er een selectie is, maak niet-actieve grijs */
        .mood-buttons.has-selection .mood-btn:not(.active) {
            color: #d1d5db;
            opacity: 0.4;
        }
        .mood-btn.active {
            opacity: 1;
        }
        .mood-btn.good.active {
            color: var(--success);
        }
        .mood-btn.neutral.active {
            color: var(--warning);
        }
        .mood-btn.bad.active {
            color: var(--danger);
        }
        
        .entry-label {
            flex: 1;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--gray-700);
        }
        .entry-multiplier {
            font-size: 0.6rem;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
            padding: 3px 7px;
            border-radius: 6px;
            margin-left: 8px;
            font-weight: 700;
        }
        .entry-points {
            font-size: 0.8rem;
            color: var(--gray-400);
            margin-right: 14px;
            min-width: 45px;
            text-align: right;
            font-weight: 600;
        }
        .entry-points.positive { color: var(--success); }
        .entry-points.negative { color: var(--danger); }
        .entry-points.highlight { color: var(--warning); }
        .entry-toggle {
            display: flex;
            gap: 8px;
        }
        .toggle-btn {
            width: 46px;
            height: 38px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-400);
        }
        .toggle-btn:hover { 
            border-color: var(--gray-300); 
            transform: scale(1.03);
        }
        .toggle-btn.yes.active {
            background: linear-gradient(145deg, #10b981, #34d399);
            border-color: transparent;
            color: white;
            box-shadow: 0 3px 12px rgba(16, 185, 129, 0.35);
        }
        .toggle-btn.no.active {
            background: linear-gradient(145deg, #ef4444, #f87171);
            border-color: transparent;
            color: white;
            box-shadow: 0 3px 12px rgba(239, 68, 68, 0.35);
        }

        /* Week Overview */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        .week-day {
            border-radius: var(--radius-sm);
            background: var(--gray-50);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            padding: 10px 4px;
            min-height: 64px;
        }
        .week-day:hover { transform: scale(1.04); }
        .week-day.positive { background: linear-gradient(145deg, #ecfdf5, #d1fae5); }
        .week-day.positive .week-day-score { color: var(--success); }
        .week-day.negative { background: linear-gradient(145deg, #fef2f2, #fee2e2); }
        .week-day.negative .week-day-score { color: var(--danger); }
        .week-day.neutral { background: linear-gradient(145deg, #fffbeb, #fef3c7); }
        .week-day.neutral .week-day-score { color: var(--warning); }
        .week-day.today { box-shadow: inset 0 0 0 2px var(--primary); }
        .week-day.future { opacity: 0.4; cursor: default; }
        .week-day-name { font-size: 0.65rem; font-weight: 600; color: var(--gray-500); }
        .week-day-score { font-size: 1rem; font-weight: 700; color: var(--gray-400); margin: 2px 0; }
        .week-day-date { font-size: 0.6rem; color: var(--gray-400); }
        .week-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-100);
        }
        .week-stat {
            text-align: center;
        }
        .week-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }
        .week-stat-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            margin-top: 2px;
        }

        /* Month Calendar */
        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .month-nav {
            display: flex;
            gap: 8px;
        }
        .month-nav-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--gray-200);
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: var(--gray-600);
            transition: var(--transition);
        }
        .month-nav-btn:hover { background: var(--gray-50); }
        .month-title {
            font-weight: 600;
            color: var(--gray-700);
        }
        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .month-day-header {
            text-align: center;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--gray-400);
            padding: 4px 0;
        }
        .month-day {
            aspect-ratio: 1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition);
        }
        .month-day:hover { background: var(--gray-100); }
        .month-day.empty { cursor: default; }
        .month-day.positive { background: var(--success-light); color: var(--success); }
        .month-day.negative { background: var(--danger-light); color: var(--danger); }
        .month-day.neutral { background: var(--warning-light); color: var(--warning); }
        .month-day.today { box-shadow: inset 0 0 0 2px var(--primary); }

        /* Statistics Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .stat-card {
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            padding: 14px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        .stat-label {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 2px;
        }
        .stat-trend {
            font-size: 0.7rem;
            margin-top: 4px;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        .stat-trend.up { background: var(--success-light); color: var(--success); }
        .stat-trend.down { background: var(--danger-light); color: var(--danger); }

        /* Weekly Challenge */
        /* Badges */
        .badges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .badges-count {
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 500;
        }
        .badges-toggle {
            transition: transform 0.3s;
        }
        .badges-toggle.collapsed { transform: rotate(-90deg); }
        .badges-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 16px;
            transition: var(--transition);
        }
        .badges-content.collapsed { display: none; }
        .badge {
            text-align: center;
            padding: 12px 6px;
            border-radius: var(--radius-sm);
            background: var(--gray-50);
            transition: var(--transition);
        }
        .badge.earned {
            background: linear-gradient(135deg, var(--warning-light), #fef9c3);
            transform: scale(1.02);
        }
        .badge-icon {
            font-size: 1.75rem;
            filter: grayscale(100%);
            opacity: 0.3;
        }
        .badge.earned .badge-icon {
            filter: none;
            opacity: 1;
        }
        .badge-name {
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--gray-600);
            margin-top: 4px;
        }

        /* Motivation Card - Redesigned */
        .motivation-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 14px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }
        .motivation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), #8b5cf6, #a855f7);
        }
        .motivation-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .motivation-icon {
            font-size: 2rem;
            width: 52px;
            height: 52px;
            background: linear-gradient(145deg, #eef2ff, #e0e7ff);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .motivation-theme {
            font-size: 0.7rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            flex: 1;
        }
        .motivation-refresh {
            background: var(--gray-100);
            border: none;
            color: var(--gray-500);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }
        .motivation-refresh:hover { 
            background: var(--gray-200); 
            transform: rotate(180deg); 
        }
        .motivation-quote {
            font-size: 1.1rem;
            font-weight: 500;
            line-height: 1.7;
            color: var(--gray-700);
            font-style: italic;
            margin-bottom: 8px;
        }
        .motivation-author {
            font-size: 0.85rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        /* Challenge Card - Redesigned */
        .challenge-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 14px;
            box-shadow: var(--shadow);
        }
        .challenge-card .challenge-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
        }
        .challenge-icon-wrap {
            font-size: 1.5rem;
            width: 48px;
            height: 48px;
            background: linear-gradient(145deg, #fffbeb, #fef3c7);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .challenge-card .challenge-info {
            flex: 1;
        }
        .challenge-card .challenge-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gray-800);
        }
        .challenge-card .challenge-desc {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-top: 2px;
        }
        .challenge-card .challenge-reward {
            background: linear-gradient(145deg, var(--warning), #fbbf24);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        .challenge-card .challenge-progress {
            height: 10px;
            background: var(--gray-100);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .challenge-card .challenge-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--warning), #fbbf24);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        .challenge-card .challenge-status {
            font-size: 0.8rem;
            color: var(--gray-500);
            text-align: center;
        }

        /* Chart */
        .chart-container {
            height: 200px;
            margin-top: 12px;
        }

        /* Bottom Actions */
        .bottom-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .action-btn {
            flex: 1;
            padding: 16px;
            border-radius: var(--radius);
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .action-btn.secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        .action-btn.secondary:hover { background: rgba(255,255,255,0.25); }
        .action-btn.danger {
            background: rgba(239,68,68,0.15);
            color: white;
            border: 1px solid rgba(239,68,68,0.3);
        }
        .action-btn.danger:hover { background: rgba(239,68,68,0.25); }

        /* Sound Toggle */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: white;
            box-shadow: var(--shadow);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            z-index: 100;
        }
        .sound-toggle:hover { transform: scale(1.05); }
        .sound-toggle.muted { opacity: 0.5; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: flex-end;
            justify-content: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white;
            border-radius: var(--radius) var(--radius) 0 0;
            padding: 24px;
            width: 100%;
            max-width: 480px;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-800);
        }
        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--gray-100);
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--gray-600);
            transition: var(--transition);
        }
        .modal-close:hover { background: var(--gray-200); }

        /* Form */
        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-600);
            margin-bottom: 6px;
        }
        .form-input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .btn-primary {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        .btn-primary:hover { background: var(--primary-dark); }

        /* Category Item in Settings */
        .category-item {
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            padding: 14px;
            margin-bottom: 10px;
        }
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .category-name {
            font-weight: 600;
            color: var(--gray-700);
        }
        .category-delete {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background: var(--danger-light);
            color: var(--danger);
            cursor: pointer;
            font-size: 0.9rem;
        }
        .category-points {
            display: flex;
            gap: 10px;
        }
        .category-points .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        .category-points .form-input {
            padding: 8px 10px;
            font-size: 0.9rem;
        }

        /* Badge Popup */
        .badge-popup {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .badge-popup.show { display: flex; }
        .badge-popup-content {
            background: white;
            border-radius: var(--radius);
            padding: 32px;
            text-align: center;
            animation: popIn 0.3s ease;
            max-width: 300px;
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .badge-popup-icon { font-size: 4rem; margin-bottom: 16px; }
        .badge-popup-title { font-size: 1.25rem; font-weight: 700; color: var(--gray-800); margin-bottom: 8px; }
        .badge-popup-desc { color: var(--gray-600); margin-bottom: 20px; }
        .badge-popup-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
        }

        /* Confetti */
        .confetti {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 9999;
        }

        /* Swipe hint */
        .swipe-hint {
            text-align: center;
            color: rgba(255,255,255,0.6);
            font-size: 0.75rem;
            margin-bottom: 8px;
        }

        /* Responsive */
        @media (max-width: 380px) {
            .score-value { font-size: 1.75rem; }
            .badges-content { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- Header -->
        <div class="header">
            <h1 id="appTitle">Lifestyle Tracker</h1>
            <p id="appSubtitle">Bouw aan een beter leven</p>
        </div>

        <!-- Streak Banner -->
        <div id="streakBanner" class="streak-banner hidden">
            <span class="streak-fire">üî•</span>
            <span id="streakText">3 dagen op rij!</span>
            <span class="streak-fire">üî•</span>
        </div>

        <!-- Score Cards -->
        <div class="scores">
            <div class="score-card today" id="todayCard">
                <div class="score-label" id="dayLabel">Vandaag</div>
                <div class="score-value" id="todayScore">0</div>
            </div>
            <div class="score-card total">
                <div class="score-label">Totaal</div>
                <div class="score-value" id="totalScore">0</div>
            </div>
        </div>

        <!-- Motivation Quote -->
        <div class="motivation-card">
            <div class="motivation-header">
                <div class="motivation-icon" id="motivationIcon">üí™</div>
                <div class="motivation-theme" id="motivationTheme">DISCIPLINE</div>
                <button class="motivation-refresh" onclick="refreshMotivation()">‚Üª</button>
            </div>
            <div class="motivation-quote" id="motivationQuote">"Succes is de som van kleine inspanningen, dag in dag uit herhaald."</div>
            <div class="motivation-author" id="motivationAuthor">‚Äî Robert Collier</div>
        </div>

        <!-- Daily Goal -->
        <div class="daily-goal">
            <div class="daily-goal-icon">üéØ</div>
            <div class="daily-goal-text">
                <div class="daily-goal-title">Dagdoel: <span id="goalTarget">+2</span></div>
                <div class="daily-goal-sub" id="goalStatus">Nog 4 punten te gaan</div>
            </div>
            <div class="daily-goal-progress" id="goalProgress" style="--progress: 0%">
                <span id="goalPercent">0%</span>
            </div>
        </div>

        <!-- Day Navigator -->
        <div class="swipe-hint">‚Üê swipe om te navigeren ‚Üí</div>
        <div class="day-nav">
            <button class="day-nav-btn" onclick="navigateDay(-1)">‚Äπ</button>
            <div class="day-nav-current">
                <div class="day-nav-date" id="currentDate">Vandaag</div>
                <div class="day-nav-sub" id="currentDateSub"></div>
            </div>
            <button class="day-nav-btn" id="nextDayBtn" onclick="navigateDay(1)">‚Ä∫</button>
        </div>

        <!-- Quick Entry -->
        <div class="quick-entry" id="quickEntry">
            <!-- Generated by JS -->
        </div>

        <!-- Week Overview -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üìÖ Laatste 7 dagen</div>
            </div>
            <div class="week-grid" id="weekGrid"></div>
            <div class="week-stats">
                <div class="week-stat">
                    <div class="week-stat-value" id="weekAvg">0</div>
                    <div class="week-stat-label">Gemiddeld</div>
                </div>
                <div class="week-stat">
                    <div class="week-stat-value" id="weekBest">-</div>
                    <div class="week-stat-label">Beste</div>
                </div>
                <div class="week-stat">
                    <div class="week-stat-value" id="weekTotal">0</div>
                    <div class="week-stat-label">Totaal</div>
                </div>
            </div>
        </div>

        <!-- Weekly Challenge -->
        <div class="challenge-card">
            <div class="challenge-header">
                <div class="challenge-icon-wrap">üèÜ</div>
                <div class="challenge-info">
                    <div class="challenge-title" id="challengeTitle">Week Challenge</div>
                    <div class="challenge-desc" id="challengeDesc">Behaal 5 positieve dagen deze week</div>
                </div>
                <div class="challenge-reward" id="challengeReward">+50 XP</div>
            </div>
            <div class="challenge-progress">
                <div class="challenge-progress-fill" id="challengeProgress" style="width: 0%"></div>
            </div>
            <div class="challenge-status" id="challengeStatus">0 van 5 dagen voltooid</div>
        </div>

        <!-- Level System -->
        <div class="card level-card">
            <div class="level-header">
                <div>
                    <div class="level-title"><span id="levelTitle">Beginner</span> <button class="xp-help-btn" onclick="showXpHelp()">?</button></div>
                    <div class="level-xp"><span id="currentXP">0</span> / <span id="nextLevelXP">100</span> XP</div>
                </div>
                <div class="level-badge">Level <span id="currentLevel">1</span></div>
            </div>
            <div class="level-progress">
                <div class="level-progress-fill" id="levelProgress" style="width: 0%"></div>
            </div>
        </div>

        <!-- Month Calendar -->
        <div class="card">
            <div class="month-header">
                <button class="month-nav-btn" onclick="navigateMonth(-1)">‚Äπ</button>
                <div class="month-title" id="monthTitle">December 2024</div>
                <button class="month-nav-btn" onclick="navigateMonth(1)">‚Ä∫</button>
            </div>
            <div class="month-grid" id="monthGrid"></div>
        </div>

        <!-- Badges -->
        <div class="card">
            <div class="badges-header" onclick="toggleBadges()">
                <div class="card-title">üèÖ Badges <span class="badges-count" id="badgesCount">(0/12)</span></div>
                <span class="badges-toggle" id="badgesToggle">‚ñº</span>
            </div>
            <div class="badges-content collapsed" id="badgesContent"></div>
        </div>

        <!-- Progress Chart -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üìà Voortgang</div>
            </div>
            <div class="chart-container">
                <canvas id="progressChart"></canvas>
            </div>
        </div>

        <!-- Bottom Actions -->
        <div class="bottom-actions">
            <button class="action-btn secondary" onclick="openSettings()" style="flex: none; width: 100%;">‚öôÔ∏è Instellingen</button>
        </div>
    </div>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</button>

    <!-- Badge Popup -->
    <div class="badge-popup" id="badgePopup">
        <div class="badge-popup-content">
            <div class="badge-popup-icon" id="badgePopupIcon">üèÜ</div>
            <div class="badge-popup-title" id="badgePopupTitle">Badge Behaald!</div>
            <div class="badge-popup-desc" id="badgePopupDesc">Je hebt een nieuwe badge verdiend!</div>
            <button class="badge-popup-btn" onclick="closeBadgePopup()">Geweldig!</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Instellingen</div>
                <button class="modal-close" onclick="closeSettings()">√ó</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">App Titel</label>
                <input type="text" class="form-input" id="appTitleInput" placeholder="Lifestyle Tracker">
            </div>
            
            <div class="form-group">
                <label class="form-label">Dagdoel</label>
                <input type="number" class="form-input" id="dailyGoalInput" placeholder="2" value="2">
            </div>
            
            <div class="form-group">
                <label class="form-label">Categorie√´n</label>
                <div id="categoriesList"></div>
                <button class="btn-primary" style="margin-top: 10px; background: var(--success);" onclick="addCategory()">+ Categorie toevoegen</button>
            </div>
            
            <button class="btn-primary" onclick="saveSettings()">Opslaan</button>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--gray-200);">
                <label class="form-label">üí° XP Verdienen</label>
                <div style="background: var(--gray-50); border-radius: 10px; padding: 14px; font-size: 0.85rem; color: var(--gray-600);">
                    <div style="margin-bottom: 8px;"><strong style="color: var(--primary);">+10 XP</strong> ‚Äî Positieve activiteit (per activiteit, 1x per dag)</div>
                    <div style="margin-bottom: 8px;"><strong style="color: var(--primary);">+25 XP</strong> ‚Äî Badge verdienen</div>
                    <div style="margin-bottom: 12px;"><strong style="color: var(--primary);">+50 XP</strong> ‚Äî Week challenge voltooien</div>
                    <div style="font-size: 0.75rem; color: var(--gray-500);">
                        <strong>Levels:</strong> Beginner ‚Üí Starter (100) ‚Üí Gemotiveerd (250) ‚Üí Doorzetter (500) ‚Üí Gevorderd (1000) ‚Üí Expert (2000) ‚Üí Meester (4000) ‚Üí Legende (8000) ‚Üí Kampioen (15000)
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--gray-200);">
                <label class="form-label" style="color: var(--danger);">Gevarenzone</label>
                <button class="btn-primary" style="background: var(--danger);" onclick="resetAll()">üóëÔ∏è Alles resetten</button>
            </div>
        </div>
    </div>

    <script>
    // ============ CONFIGURATION ============
    const STORAGE_KEYS = {
        state: 'lt_state_v2',
        categories: 'lt_categories_v2',
        settings: 'lt_settings_v2',
        badges: 'lt_badges_v2',
        records: 'lt_records_v2',
        sound: 'lt_sound_v2'
    };

    const DEFAULT_CATEGORIES = [
        { key: 'sleep', label: 'Goede nachtrust', pointsYes: 1, pointsNo: 0 },
        { key: 'exercise', label: 'Sporten', pointsYes: 1, pointsNo: 0 },
        { key: 'nutrition', label: 'Gezond eten', pointsYes: 1, pointsNo: 0 },
        { key: 'meditation', label: 'Meditatie', pointsYes: 1, pointsNo: 0 },
        { key: 'learning', label: 'Persoonlijke ontwikkeling', pointsYes: 1, pointsNo: 0 },
        { key: 'noAlcohol', label: 'Geen alcohol', pointsYes: 0, pointsNo: -2 },
        { key: 'noBadHabits', label: 'Geen slechte gewoontes', pointsYes: 0, pointsNo: -2 }
    ];

    const LEVELS = [
        { name: 'Beginner', xp: 0 },
        { name: 'Starter', xp: 100 },
        { name: 'Gemotiveerd', xp: 250 },
        { name: 'Doorzetter', xp: 500 },
        { name: 'Gevorderd', xp: 1000 },
        { name: 'Expert', xp: 2000 },
        { name: 'Meester', xp: 4000 },
        { name: 'Legende', xp: 8000 },
        { name: 'Kampioen', xp: 15000 }
    ];

    const QUOTES = {
        discipline: {
            icon: 'üí™', name: 'DISCIPLINE',
            quotes: [
                { text: 'Succes is de som van kleine inspanningen, dag in dag uit herhaald.', author: 'Robert Collier' },
                { text: 'Discipline is de brug tussen doelen en resultaten.', author: 'Jim Rohn' },
                { text: 'We worden wat we herhaaldelijk doen.', author: 'Aristoteles' }
            ]
        },
        growth: {
            icon: 'üå±', name: 'GROEI',
            quotes: [
                { text: 'Elke meester was ooit een beginner.', author: 'T. Harv Eker' },
                { text: 'Het maakt niet uit hoe langzaam je gaat, zolang je niet stopt.', author: 'Confucius' },
                { text: 'Groei begint waar je comfortzone eindigt.', author: 'Onbekend' }
            ]
        },
        mindset: {
            icon: 'üß†', name: 'MINDSET',
            quotes: [
                { text: 'Of je denkt dat je het kunt, of niet - je hebt altijd gelijk.', author: 'Henry Ford' },
                { text: 'Verander je gedachten en je verandert je wereld.', author: 'Norman Peale' }
            ]
        },
        health: {
            icon: '‚ù§Ô∏è', name: 'GEZONDHEID',
            quotes: [
                { text: 'Zorg goed voor je lichaam. Het is de enige plek waar je moet leven.', author: 'Jim Rohn' },
                { text: 'De grootste rijkdom is gezondheid.', author: 'Vergilius' }
            ]
        }
    };

    const BADGES = [
        { id: 'first', icon: '‚≠ê', name: 'Eerste stap', desc: 'Eerste dag', check: () => Object.keys(state.days).length >= 1 },
        { id: 'week', icon: 'üìÖ', name: 'Week vol', desc: '7 dagen actief', check: () => Object.keys(state.days).length >= 7 },
        { id: 'month', icon: 'üóìÔ∏è', name: 'Maand door', desc: '30 dagen actief', check: () => Object.keys(state.days).length >= 30 },
        { id: 'streak3', icon: 'üî•', name: 'Op dreef', desc: '3 dagen streak', check: () => getStreak() >= 3 },
        { id: 'streak7', icon: 'üí´', name: 'Week streak', desc: '7 dagen streak', check: () => getStreak() >= 7 },
        { id: 'streak30', icon: 'üåü', name: 'Maand streak', desc: '30 dagen streak', check: () => getStreak() >= 30 },
        { id: 'perfect', icon: 'üíé', name: 'Perfecte dag', desc: 'Score van 5+', check: () => todayScore >= 5 },
        { id: 'pos10', icon: 'üéØ', name: 'Positivo', desc: '10 positieve dagen', check: () => countPositiveDays() >= 10 },
        { id: 'total50', icon: 'üèÜ', name: 'Halfweg', desc: '50 totaal punten', check: () => totalScore >= 50 },
        { id: 'total100', icon: 'üëë', name: 'Kampioen', desc: '100 totaal punten', check: () => totalScore >= 100 },
        { id: 'level5', icon: 'üöÄ', name: 'Level 5', desc: 'Bereik level 5', check: () => getCurrentLevel() >= 5 },
        { id: 'comeback', icon: 'üí™', name: 'Comeback', desc: 'Positief na negatief', check: () => checkComeback() }
    ];

    // ============ STATE ============
    let state = { days: {}, xp: 0 };
    let categories = [];
    let settings = { title: 'Lifestyle Tracker', dailyGoal: 2 };
    let earnedBadges = [];
    let records = { streak: 0, highScore: 0, bestWeek: 0 };
    let soundEnabled = true;
    let activities = {};
    let highlights = {};
    let moods = {};
    let todayScore = 0;
    let totalScore = 0;
    let viewingDate = null;
    let viewingMonth = new Date();
    let chart = null;

    // ============ HELPERS ============
    const getTodayKey = () => {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    };

    const getDateKey = (date) => {
        return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
    };

    const parseDate = (key) => {
        const [y, m, d] = key.split('-').map(Number);
        return new Date(y, m - 1, d);
    };

    const formatDate = (date) => {
        const days = ['zo', 'ma', 'di', 'wo', 'do', 'vr', 'za'];
        const months = ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'];
        return `${days[date.getDay()]} ${date.getDate()} ${months[date.getMonth()]}`;
    };

    const save = (key, data) => {
        try { localStorage.setItem(STORAGE_KEYS[key], JSON.stringify(data)); } catch(e) {}
    };

    const load = (key) => {
        try { 
            const d = localStorage.getItem(STORAGE_KEYS[key]); 
            return d ? JSON.parse(d) : null; 
        } catch(e) { return null; }
    };

    // ============ CORE FUNCTIONS ============
    function init() {
        // Load data
        state = load('state') || { days: {}, xp: 0 };
        categories = load('categories') || [...DEFAULT_CATEGORIES];
        settings = load('settings') || { title: 'Lifestyle Tracker', dailyGoal: 2 };
        earnedBadges = load('badges') || [];
        records = load('records') || { streak: 0, highScore: 0, bestWeek: 0 };
        soundEnabled = load('sound') !== false;

        // Initialize today if needed
        const today = getTodayKey();
        if (!state.days[today]) {
            state.days[today] = { activities: {}, highlights: {}, score: calculateBaseScore() };
            save('state', state);
        }

        // Load today's activities
        loadDay(today);

        // Update UI
        document.getElementById('appTitle').textContent = settings.title;
        document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
        document.getElementById('soundToggle').classList.toggle('muted', !soundEnabled);
        
        updateAll();
        refreshMotivation();
        setupSwipe();
    }

    function calculateBaseScore() {
        let score = -2; // Base penalty
        return score;
    }

    function calculateScore() {
        let score = -2;
        categories.forEach(cat => {
            const val = activities[cat.key];
            const multiplier = highlights[cat.key] ? 2 : 1;
            if (val === true) score += cat.pointsYes * multiplier;
            else if (val === false) score += cat.pointsNo * multiplier;
        });
        return score;
    }

    function loadDay(dateKey) {
        const dayData = state.days[dateKey];
        activities = {};
        highlights = {};
        moods = {};
        categories.forEach(cat => {
            activities[cat.key] = dayData?.activities?.[cat.key] ?? null;
            highlights[cat.key] = dayData?.highlights?.[cat.key] ?? false;
        });
        moods = dayData?.moods || {};
        // Herbereken score op basis van geladen activities en highlights
        todayScore = calculateScore();
    }

    function saveDay() {
        const dateKey = viewingDate || getTodayKey();
        const existingXpAwarded = state.days[dateKey]?.xpAwarded || {};
        state.days[dateKey] = {
            activities: { ...activities },
            highlights: { ...highlights },
            moods: { ...moods },
            score: todayScore,
            xpAwarded: existingXpAwarded
        };
        save('state', state);
    }

    function handleToggle(key, value) {
        const oldScore = todayScore;
        const oldValue = activities[key];
        activities[key] = activities[key] === value ? null : value;
        todayScore = calculateScore();
        saveDay();

        // XP alleen bij NIEUWE positieve actie per dag
        const dateKey = viewingDate || getTodayKey();
        if (!state.days[dateKey].xpAwarded) {
            state.days[dateKey].xpAwarded = {};
        }
        
        if (activities[key] === true && !state.days[dateKey].xpAwarded[key]) {
            const cat = categories.find(c => c.key === key);
            if (cat && cat.pointsYes > 0) {
                addXP(10);
                state.days[dateKey].xpAwarded[key] = true;
                save('state', state);
            }
        }

        // Sound
        if (activities[key] === true) playSound('success');
        else if (activities[key] === false) playSound('negative');
        else playSound('click');

        // Update met animatie
        const direction = todayScore > oldScore ? 'up' : (todayScore < oldScore ? 'down' : null);
        updateAllWithAnimation(direction);

        // Check for completion celebration
        if (checkAllAnswered() && todayScore > 0 && oldScore <= 0) {
            triggerConfetti();
        }
    }

    function toggleHighlight(key) {
        const oldScore = todayScore;
        highlights[key] = !highlights[key];
        todayScore = calculateScore();
        saveDay();
        playSound('click');
        
        const direction = todayScore > oldScore ? 'up' : (todayScore < oldScore ? 'down' : null);
        updateAllWithAnimation(direction);
    }

    function updateAllWithAnimation(direction = null) {
        totalScore = calculateTotalScore();
        
        updateScoreCards(true, direction);
        updateDayNavigator();
        updateQuickEntry();
        updateDailyGoal();
        updateLevel();
        updateChallenge();
        updateStreak();
        updateWeekOverview();
        updateMonthCalendar();
        updateBadges();
        updateChart();
    }

    function checkAllAnswered() {
        return categories.every(cat => activities[cat.key] !== null);
    }

    function getMood(type) {
        return moods[type] || null;
    }

    function setMood(type, value) {
        moods[type] = moods[type] === value ? null : value;
        saveDay();
        playSound('click');
        updateQuickEntry();
    }

    // ============ NAVIGATION ============
    function navigateDay(offset) {
        const current = viewingDate ? parseDate(viewingDate) : new Date();
        current.setDate(current.getDate() + offset);
        const newKey = getDateKey(current);
        const today = getTodayKey();

        if (newKey > today) return;

        viewingDate = newKey === today ? null : newKey;
        loadDay(viewingDate || today);
        updateAll();
        playSound('click');
    }

    function navigateMonth(offset) {
        viewingMonth.setMonth(viewingMonth.getMonth() + offset);
        updateMonthCalendar();
        playSound('click');
    }

    function setupSwipe() {
        let touchStartX = 0;
        let touchStartY = 0;
        const container = document.getElementById('quickEntry');
        
        container.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        container.addEventListener('touchend', e => {
            const diffX = touchStartX - e.changedTouches[0].clientX;
            const diffY = touchStartY - e.changedTouches[0].clientY;
            
            // Alleen horizontale swipe (niet verticaal scrollen)
            if (Math.abs(diffX) > 50 && Math.abs(diffX) > Math.abs(diffY)) {
                const direction = diffX > 0 ? 1 : -1;
                
                // Check of we kunnen navigeren
                const todayKey = getTodayKey();
                if (direction === 1 && (!viewingDate || viewingDate === todayKey)) {
                    return; // Kan niet naar de toekomst
                }
                
                // Swipe animatie
                container.classList.add(direction > 0 ? 'swipe-left' : 'swipe-right');
                
                setTimeout(() => {
                    navigateDay(direction);
                    container.classList.remove('swipe-left', 'swipe-right');
                }, 150);
            }
        }, { passive: true });
    }

    // ============ XP & LEVELS ============
    function addXP(amount) {
        state.xp = (state.xp || 0) + amount;
        save('state', state);
        updateLevel();
    }

    function getCurrentLevel() {
        let level = 1;
        for (let i = LEVELS.length - 1; i >= 0; i--) {
            if ((state.xp || 0) >= LEVELS[i].xp) {
                level = i + 1;
                break;
            }
        }
        return level;
    }

    function updateLevel() {
        const xp = state.xp || 0;
        const level = getCurrentLevel();
        const currentLevelData = LEVELS[level - 1];
        const nextLevelData = LEVELS[level] || LEVELS[LEVELS.length - 1];
        
        const xpInLevel = xp - currentLevelData.xp;
        const xpNeeded = nextLevelData.xp - currentLevelData.xp;
        const progress = Math.min((xpInLevel / xpNeeded) * 100, 100);

        document.getElementById('currentLevel').textContent = level;
        document.getElementById('levelTitle').textContent = currentLevelData.name;
        document.getElementById('currentXP').textContent = xp;
        document.getElementById('nextLevelXP').textContent = nextLevelData.xp;
        document.getElementById('levelProgress').style.width = progress + '%';
    }

    // ============ DAILY GOAL ============
    function updateDailyGoal() {
        const goal = settings.dailyGoal || 2;
        // Progress van -2 (0%) naar goal (100%)
        const progress = Math.max(0, Math.min(100, ((todayScore + 2) / (goal + 2)) * 100));
        const degrees = Math.round(progress * 3.6);
        
        document.getElementById('goalTarget').textContent = '+' + goal;
        document.getElementById('goalProgress').style.background = 
            `conic-gradient(var(--warning) 0deg, var(--warning) ${degrees}deg, var(--gray-200) ${degrees}deg, var(--gray-200) 360deg)`;
        document.getElementById('goalPercent').textContent = Math.round(progress) + '%';
        
        if (todayScore >= goal) {
            document.getElementById('goalStatus').textContent = '‚úì Doel behaald!';
        } else {
            const needed = goal - todayScore;
            document.getElementById('goalStatus').textContent = `Nog ${needed} punt${needed !== 1 ? 'en' : ''} te gaan`;
        }
    }

    // ============ WEEKLY CHALLENGE ============
    function updateChallenge() {
        const today = new Date();
        const dayOfWeek = today.getDay();
        const monday = new Date(today);
        monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

        let positiveDays = 0;
        for (let i = 0; i < 7; i++) {
            const d = new Date(monday);
            d.setDate(monday.getDate() + i);
            const key = getDateKey(d);
            if (state.days[key]?.score > 0) positiveDays++;
        }

        const target = 5;
        const progress = (positiveDays / target) * 100;
        
        document.getElementById('challengeProgress').style.width = Math.min(progress, 100) + '%';
        document.getElementById('challengeStatus').textContent = `${positiveDays} van ${target} dagen voltooid`;
        
        if (positiveDays >= target) {
            document.getElementById('challengeTitle').textContent = '‚úì Challenge voltooid!';
            document.getElementById('challengeStatus').textContent = `üéâ Gefeliciteerd! ${positiveDays}/${target} dagen`;
        }
    }

    // ============ STATISTICS ============
    function calculateTotalScore() {
        let total = 0;
        Object.values(state.days).forEach(day => {
            total += day.score || 0;
        });
        return total;
    }

    function getStreak() {
        const dates = Object.keys(state.days).sort().reverse();
        let streak = 0;
        for (const date of dates) {
            if (state.days[date]?.score > 0) streak++;
            else break;
        }
        return streak;
    }

    function countPositiveDays() {
        return Object.values(state.days).filter(d => d.score > 0).length;
    }

    function checkComeback() {
        const dates = Object.keys(state.days).sort().reverse();
        if (dates.length < 2) return false;
        return state.days[dates[0]]?.score > 0 && state.days[dates[1]]?.score < 0;
    }

    function updateStatistics() {
        const days = Object.entries(state.days);
        const totalDays = days.length;
        const positiveDays = countPositiveDays();
        
        // Best day score
        let bestScore = 0;
        days.forEach(([_, d]) => {
            if (d.score > bestScore) bestScore = d.score;
        });

        // Best weekday
        const weekdayScores = [0, 0, 0, 0, 0, 0, 0];
        const weekdayCounts = [0, 0, 0, 0, 0, 0, 0];
        days.forEach(([key, d]) => {
            const date = parseDate(key);
            const day = date.getDay();
            weekdayScores[day] += d.score;
            weekdayCounts[day]++;
        });
        
        let bestWeekday = 0;
        let bestWeekdayAvg = -Infinity;
        const dayNames = ['Zo', 'Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za'];
        weekdayScores.forEach((score, i) => {
            if (weekdayCounts[i] > 0) {
                const avg = score / weekdayCounts[i];
                if (avg > bestWeekdayAvg) {
                    bestWeekdayAvg = avg;
                    bestWeekday = i;
                }
            }
        });

        document.getElementById('statBestDay').textContent = bestScore > 0 ? '+' + bestScore : bestScore;
        document.getElementById('statAvgWeekday').textContent = dayNames[bestWeekday];
        document.getElementById('statPositiveDays').textContent = positiveDays;
        document.getElementById('statTotalDays').textContent = totalDays;

        // Update records
        const currentStreak = getStreak();
        if (currentStreak > records.streak) {
            records.streak = currentStreak;
            save('records', records);
        }
        if (bestScore > records.highScore) {
            records.highScore = bestScore;
            save('records', records);
        }

        document.getElementById('recordStreak').textContent = records.streak;
        document.getElementById('recordHighScore').textContent = records.highScore > 0 ? '+' + records.highScore : records.highScore;
        document.getElementById('recordWeek').textContent = records.bestWeek > 0 ? '+' + records.bestWeek : records.bestWeek;
    }

    // ============ UI UPDATES ============
    function updateAll() {
        totalScore = calculateTotalScore();
        
        updateScoreCards();
        updateDayNavigator();
        updateQuickEntry();
        updateDailyGoal();
        updateLevel();
        updateChallenge();
        updateStreak();
        updateWeekOverview();
        updateMonthCalendar();
        updateBadges();
        updateChart();
    }

    function updateScoreCards(animate = false, direction = null) {
        const todayScoreEl = document.getElementById('todayScore');
        const totalScoreEl = document.getElementById('totalScore');
        
        todayScoreEl.textContent = (todayScore > 0 ? '+' : '') + todayScore;
        totalScoreEl.textContent = (totalScore > 0 ? '+' : '') + totalScore;

        // Animatie bij score verandering
        if (animate && direction) {
            const animClass = direction === 'up' ? 'bump-up' : 'bump-down';
            todayScoreEl.classList.add(animClass);
            totalScoreEl.classList.add('bump');
            
            setTimeout(() => {
                todayScoreEl.classList.remove('bump-up', 'bump-down');
                totalScoreEl.classList.remove('bump');
            }, 400);
        }

        const card = document.getElementById('todayCard');
        card.classList.remove('negative', 'neutral', 'positive');
        if (todayScore < 0) card.classList.add('negative');
        else if (todayScore === 0) card.classList.add('neutral');
        else card.classList.add('positive');
    }

    function updateDayNavigator() {
        const today = getTodayKey();
        const isToday = !viewingDate || viewingDate === today;
        
        document.getElementById('nextDayBtn').disabled = isToday;
        
        if (isToday) {
            document.getElementById('currentDate').textContent = 'Vandaag';
            document.getElementById('currentDateSub').textContent = formatDate(new Date());
            document.getElementById('dayLabel').textContent = 'Vandaag';
        } else {
            const date = parseDate(viewingDate);
            document.getElementById('currentDate').textContent = formatDate(date);
            const daysAgo = Math.round((new Date() - date) / (1000 * 60 * 60 * 24));
            document.getElementById('currentDateSub').textContent = `${daysAgo} dag${daysAgo !== 1 ? 'en' : ''} geleden`;
            document.getElementById('dayLabel').textContent = 'Deze dag';
        }
    }

    function updateQuickEntry() {
        const container = document.getElementById('quickEntry');
        container.innerHTML = categories.map(cat => {
            const val = activities[cat.key];
            const isHighlighted = highlights[cat.key] || false;
            const multiplier = isHighlighted ? 2 : 1;
            let pointsText = '';
            let pointsClass = '';
            
            if (val === true && cat.pointsYes !== 0) {
                const pts = cat.pointsYes * multiplier;
                pointsText = (pts > 0 ? '+' : '') + pts;
                pointsClass = pts > 0 ? 'positive' : 'negative';
                if (isHighlighted) pointsClass = 'highlight';
            } else if (val === false && cat.pointsNo !== 0) {
                const pts = cat.pointsNo * multiplier;
                pointsText = (pts > 0 ? '+' : '') + pts;
                pointsClass = pts > 0 ? 'positive' : 'negative';
                if (isHighlighted) pointsClass = 'highlight';
            }

            return `
                <div class="entry-item ${isHighlighted ? 'highlighted' : ''}">
                    <div class="entry-label">
                        ${cat.label}
                        ${isHighlighted ? '<span class="entry-multiplier">2√ó</span>' : ''}
                    </div>
                    <div class="entry-points ${pointsClass}">${pointsText}</div>
                    <div class="entry-toggle">
                        <button class="toggle-btn yes ${val === true ? 'active' : ''}" 
                                onclick="handleToggle('${cat.key}', true)">‚úì</button>
                        <button class="toggle-btn no ${val === false ? 'active' : ''}" 
                                onclick="handleToggle('${cat.key}', false)">‚úó</button>
                        <button class="highlight-btn ${isHighlighted ? 'active' : ''}" 
                                onclick="toggleHighlight('${cat.key}')" title="2x punten">‚≠ê</button>
                    </div>
                </div>
            `;
        }).join('');
        
        // Mood sectie bovenaan toevoegen
        const moodHtml = `
            <div class="mood-section">
                <div class="mood-title">Hoe is je dag?</div>
                <div class="mood-items">
                    <div class="mood-item">
                        <div class="mood-label">Stress</div>
                        <div class="mood-buttons ${getMood('stress') ? 'has-selection' : ''}">
                            <button class="mood-btn good ${getMood('stress') === 'good' ? 'active' : ''}" onclick="setMood('stress', 'good')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><path d="M10 22c2 4 6 6 8 6s6-2 8-6" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>
                            </button>
                            <button class="mood-btn neutral ${getMood('stress') === 'neutral' ? 'active' : ''}" onclick="setMood('stress', 'neutral')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><line x1="11" y1="24" x2="25" y2="24" stroke="white" stroke-width="2.5" stroke-linecap="round"/></svg>
                            </button>
                            <button class="mood-btn bad ${getMood('stress') === 'bad' ? 'active' : ''}" onclick="setMood('stress', 'bad')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><path d="M10 26c2-4 6-6 8-6s6 2 8 6" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="mood-item">
                        <div class="mood-label">Emotie</div>
                        <div class="mood-buttons ${getMood('emotion') ? 'has-selection' : ''}">
                            <button class="mood-btn good ${getMood('emotion') === 'good' ? 'active' : ''}" onclick="setMood('emotion', 'good')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><path d="M10 22c2 4 6 6 8 6s6-2 8-6" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>
                            </button>
                            <button class="mood-btn neutral ${getMood('emotion') === 'neutral' ? 'active' : ''}" onclick="setMood('emotion', 'neutral')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><line x1="11" y1="24" x2="25" y2="24" stroke="white" stroke-width="2.5" stroke-linecap="round"/></svg>
                            </button>
                            <button class="mood-btn bad ${getMood('emotion') === 'bad' ? 'active' : ''}" onclick="setMood('emotion', 'bad')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><path d="M10 26c2-4 6-6 8-6s6 2 8 6" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="mood-item">
                        <div class="mood-label">Druk</div>
                        <div class="mood-buttons ${getMood('pressure') ? 'has-selection' : ''}">
                            <button class="mood-btn good ${getMood('pressure') === 'good' ? 'active' : ''}" onclick="setMood('pressure', 'good')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><path d="M10 22c2 4 6 6 8 6s6-2 8-6" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>
                            </button>
                            <button class="mood-btn neutral ${getMood('pressure') === 'neutral' ? 'active' : ''}" onclick="setMood('pressure', 'neutral')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><line x1="11" y1="24" x2="25" y2="24" stroke="white" stroke-width="2.5" stroke-linecap="round"/></svg>
                            </button>
                            <button class="mood-btn bad ${getMood('pressure') === 'bad' ? 'active' : ''}" onclick="setMood('pressure', 'bad')">
                                <svg viewBox="0 0 36 36"><circle cx="18" cy="18" r="16" fill="currentColor"/><circle cx="12" cy="14" r="2.5" fill="white"/><circle cx="24" cy="14" r="2.5" fill="white"/><path d="M10 26c2-4 6-6 8-6s6 2 8 6" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        container.innerHTML = moodHtml + container.innerHTML;
    }

    function updateStreak() {
        const streak = getStreak();
        const banner = document.getElementById('streakBanner');
        
        if (streak >= 2) {
            banner.classList.remove('hidden');
            document.getElementById('streakText').textContent = `${streak} dagen op rij!`;
        } else {
            banner.classList.add('hidden');
        }
    }

    function updateWeekOverview() {
        const today = new Date();
        const todayKey = getTodayKey();
        
        // Laatste 7 dagen (6 dagen terug t/m vandaag)
        const dayNames = ['Zo', 'Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za'];
        let weekTotal = 0;
        let weekCount = 0;
        let weekBest = null;

        let html = '';
        // Start 6 dagen geleden, eindig met vandaag
        for (let i = -6; i <= 0; i++) {
            const d = new Date(today);
            d.setDate(today.getDate() + i);
            const key = getDateKey(d);
            const dayData = state.days[key];
            const score = dayData?.score;
            const isToday = key === todayKey;
            const dayName = dayNames[d.getDay()];

            let statusClass = '';
            if (score !== undefined && score !== null) {
                if (score > 0) { statusClass = 'positive'; }
                else if (score < 0) { statusClass = 'negative'; }
                else { statusClass = 'neutral'; }
                weekTotal += score;
                weekCount++;
                if (weekBest === null || score > weekBest) weekBest = score;
            }
            if (isToday) statusClass += ' today';

            const displayScore = score !== undefined && score !== null ? (score > 0 ? '+' + score : score) : '-';
            const displayDate = d.getDate();

            html += `
                <div class="week-day ${statusClass}" onclick="goToDate('${key}')">
                    <div class="week-day-name">${dayName}</div>
                    <div class="week-day-score">${displayScore}</div>
                    <div class="week-day-date">${displayDate}</div>
                </div>
            `;
        }

        document.getElementById('weekGrid').innerHTML = html;
        document.getElementById('weekAvg').textContent = weekCount > 0 ? (weekTotal / weekCount).toFixed(1) : '0';
        document.getElementById('weekBest').textContent = weekBest !== null ? (weekBest > 0 ? '+' + weekBest : weekBest) : '-';
        document.getElementById('weekTotal').textContent = weekTotal > 0 ? '+' + weekTotal : weekTotal;

        // Update best week record
        if (weekTotal > records.bestWeek) {
            records.bestWeek = weekTotal;
            save('records', records);
        }
    }

    function updateMonthCalendar() {
        const year = viewingMonth.getFullYear();
        const month = viewingMonth.getMonth();
        const months = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni', 
                       'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
        
        document.getElementById('monthTitle').textContent = `${months[month]} ${year}`;

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDay = (firstDay.getDay() + 6) % 7; // Monday = 0
        const todayKey = getTodayKey();

        let html = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo']
            .map(d => `<div class="month-day-header">${d}</div>`).join('');

        // Empty cells before first day
        for (let i = 0; i < startDay; i++) {
            html += '<div class="month-day empty"></div>';
        }

        // Days of month
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const date = new Date(year, month, day);
            const key = getDateKey(date);
            const dayData = state.days[key];
            const score = dayData?.score;
            const isToday = key === todayKey;

            let statusClass = '';
            if (score > 0) statusClass = 'positive';
            else if (score < 0) statusClass = 'negative';
            else if (score === 0) statusClass = 'neutral';
            if (isToday) statusClass += ' today';

            html += `<div class="month-day ${statusClass}" onclick="goToDate('${key}')">${day}</div>`;
        }

        document.getElementById('monthGrid').innerHTML = html;
    }

    function goToDate(dateKey) {
        const today = getTodayKey();
        if (dateKey > today) return;
        
        viewingDate = dateKey === today ? null : dateKey;
        loadDay(viewingDate || today);
        updateAll();
        playSound('click');
        
        // Scroll to quick entry
        document.getElementById('quickEntry').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function updateBadges() {
        let earnedCount = 0;
        let html = '';

        BADGES.forEach(badge => {
            const isEarned = earnedBadges.includes(badge.id);
            
            if (!isEarned && badge.check()) {
                earnedBadges.push(badge.id);
                save('badges', earnedBadges);
                showBadgePopup(badge);
                addXP(25);
            }

            if (earnedBadges.includes(badge.id)) earnedCount++;

            html += `
                <div class="badge ${earnedBadges.includes(badge.id) ? 'earned' : ''}">
                    <div class="badge-icon">${badge.icon}</div>
                    <div class="badge-name">${badge.name}</div>
                </div>
            `;
        });

        document.getElementById('badgesContent').innerHTML = html;
        document.getElementById('badgesCount').textContent = `(${earnedCount}/${BADGES.length})`;
    }

    function toggleBadges() {
        document.getElementById('badgesContent').classList.toggle('collapsed');
        document.getElementById('badgesToggle').classList.toggle('collapsed');
        playSound('click');
    }

    function updateChart() {
        const ctx = document.getElementById('progressChart');
        if (chart) chart.destroy();

        const dates = Object.keys(state.days).sort().slice(-14);
        if (dates.length === 0) return;

        let runningTotal = 0;
        const labels = [];
        const data = [];

        // Calculate running total up to first displayed date
        Object.keys(state.days).sort().forEach(date => {
            if (date < dates[0]) runningTotal += state.days[date].score;
        });

        dates.forEach(date => {
            runningTotal += state.days[date].score;
            const d = parseDate(date);
            labels.push(`${d.getDate()}/${d.getMonth() + 1}`);
            data.push(runningTotal);
        });

        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    data,
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 4,
                    pointBackgroundColor: '#6366f1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { font: { size: 10 } } },
                    y: { grid: { color: '#f3f4f6' }, ticks: { font: { size: 10 } } }
                }
            }
        });
    }

    // ============ MOTIVATION ============
    function refreshMotivation() {
        const themes = Object.keys(QUOTES);
        const theme = QUOTES[themes[Math.floor(Math.random() * themes.length)]];
        const quote = theme.quotes[Math.floor(Math.random() * theme.quotes.length)];

        document.getElementById('motivationIcon').textContent = theme.icon;
        document.getElementById('motivationTheme').textContent = theme.name;
        document.getElementById('motivationQuote').textContent = `"${quote.text}"`;
        document.getElementById('motivationAuthor').textContent = `‚Äî ${quote.author}`;
    }

    // ============ SOUNDS ============
    function playSound(type) {
        if (!soundEnabled) return;
        
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            const sounds = {
                click: { freq: 800, dur: 0.1 },
                success: { freq: 523, dur: 0.3 },
                negative: { freq: 300, dur: 0.2 },
                badge: { freq: 440, dur: 0.5 }
            };

            const s = sounds[type] || sounds.click;
            osc.frequency.value = s.freq;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + s.dur);
            osc.start();
            osc.stop(ctx.currentTime + s.dur);
        } catch(e) {}
    }

    function toggleSound() {
        soundEnabled = !soundEnabled;
        document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
        document.getElementById('soundToggle').classList.toggle('muted', !soundEnabled);
        save('sound', soundEnabled);
        if (soundEnabled) playSound('click');
    }

    // ============ SETTINGS ============
    function openSettings() {
        document.getElementById('appTitleInput').value = settings.title;
        document.getElementById('dailyGoalInput').value = settings.dailyGoal;
        renderCategories();
        document.getElementById('settingsModal').classList.add('show');
    }

    function closeSettings() {
        document.getElementById('settingsModal').classList.remove('show');
    }

    function renderCategories() {
        document.getElementById('categoriesList').innerHTML = categories.map((cat, i) => `
            <div class="category-item">
                <div class="category-header">
                    <input type="text" class="form-input" value="${cat.label}" 
                           onchange="updateCategory(${i}, 'label', this.value)" style="flex:1;margin-right:10px;">
                    <button class="category-delete" onclick="deleteCategory(${i})">√ó</button>
                </div>
                <div class="category-points">
                    <div class="form-group">
                        <label class="form-label">Ja</label>
                        <input type="number" class="form-input" value="${cat.pointsYes}"
                               onchange="updateCategory(${i}, 'pointsYes', +this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nee</label>
                        <input type="number" class="form-input" value="${cat.pointsNo}"
                               onchange="updateCategory(${i}, 'pointsNo', +this.value)">
                    </div>
                </div>
            </div>
        `).join('');
    }

    function updateCategory(index, field, value) {
        categories[index][field] = value;
    }

    function deleteCategory(index) {
        if (categories.length <= 1) return alert('Minimaal 1 categorie nodig');
        categories.splice(index, 1);
        renderCategories();
    }

    function addCategory() {
        categories.push({ key: 'custom_' + Date.now(), label: 'Nieuwe categorie', pointsYes: 1, pointsNo: 0 });
        renderCategories();
    }

    function saveSettings() {
        settings.title = document.getElementById('appTitleInput').value || 'Lifestyle Tracker';
        settings.dailyGoal = parseInt(document.getElementById('dailyGoalInput').value) || 2;
        
        document.getElementById('appTitle').textContent = settings.title;
        
        save('settings', settings);
        save('categories', categories);
        
        // Recalculate scores
        todayScore = calculateScore();
        saveDay();
        
        closeSettings();
        updateAll();
        playSound('success');
    }

    function resetAll() {
        // Maak een custom modal voor reset bevestiging
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:9999;';
        overlay.innerHTML = `
            <div style="background:white;border-radius:16px;padding:24px;max-width:320px;text-align:center;">
                <div style="font-size:3rem;margin-bottom:16px;">‚ö†Ô∏è</div>
                <div style="font-size:1.1rem;font-weight:600;color:#374151;margin-bottom:8px;">Alles resetten?</div>
                <div style="font-size:0.9rem;color:#6b7280;margin-bottom:20px;">Dit verwijdert al je scores, XP, badges en instellingen. Dit kan niet ongedaan worden!</div>
                <div style="display:flex;gap:10px;">
                    <button onclick="this.closest('div').closest('div').remove()" style="flex:1;padding:12px;border:2px solid #e5e7eb;background:white;border-radius:10px;font-weight:600;cursor:pointer;">Annuleren</button>
                    <button onclick="doReset()" style="flex:1;padding:12px;border:none;background:#ef4444;color:white;border-radius:10px;font-weight:600;cursor:pointer;">Reset</button>
                </div>
            </div>
        `;
        document.body.appendChild(overlay);
    }

    function doReset() {
        try {
            localStorage.removeItem('lt_state_v2');
            localStorage.removeItem('lt_categories_v2');
            localStorage.removeItem('lt_settings_v2');
            localStorage.removeItem('lt_badges_v2');
            localStorage.removeItem('lt_records_v2');
            localStorage.removeItem('lt_sound_v2');
            localStorage.clear();
        } catch(e) {
            console.error('Reset error:', e);
        }
        location.reload();
    }

    function showXpHelp() {
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;';
        overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };
        overlay.innerHTML = `
            <div style="background:white;border-radius:16px;padding:24px;max-width:340px;width:100%;">
                <div style="text-align:center;margin-bottom:16px;">
                    <div style="font-size:2.5rem;margin-bottom:8px;">‚≠ê</div>
                    <div style="font-size:1.2rem;font-weight:700;color:#374151;">XP Verdienen</div>
                </div>
                <div style="background:#f9fafb;border-radius:10px;padding:14px;font-size:0.9rem;color:#4b5563;margin-bottom:16px;">
                    <div style="margin-bottom:10px;display:flex;justify-content:space-between;"><span>Positieve activiteit</span><strong style="color:#6366f1;">+10 XP</strong></div>
                    <div style="margin-bottom:10px;display:flex;justify-content:space-between;"><span>Badge verdienen</span><strong style="color:#6366f1;">+25 XP</strong></div>
                    <div style="display:flex;justify-content:space-between;"><span>Week challenge</span><strong style="color:#6366f1;">+50 XP</strong></div>
                </div>
                <div style="font-size:0.75rem;color:#6b7280;margin-bottom:16px;">
                    <strong style="color:#374151;">Levels:</strong><br>
                    Beginner (0) ‚Üí Starter (100) ‚Üí Gemotiveerd (250) ‚Üí Doorzetter (500) ‚Üí Gevorderd (1000) ‚Üí Expert (2000) ‚Üí Meester (4000) ‚Üí Legende (8000) ‚Üí Kampioen (15000)
                </div>
                <button onclick="this.closest('div').closest('div').remove()" style="width:100%;padding:12px;border:none;background:#6366f1;color:white;border-radius:10px;font-weight:600;cursor:pointer;">Begrepen!</button>
            </div>
        `;
        document.body.appendChild(overlay);
        playSound('click');
    }

    // ============ POPUPS & EFFECTS ============
    function showBadgePopup(badge) {
        document.getElementById('badgePopupIcon').textContent = badge.icon;
        document.getElementById('badgePopupTitle').textContent = badge.name;
        document.getElementById('badgePopupDesc').textContent = badge.desc;
        document.getElementById('badgePopup').classList.add('show');
        playSound('badge');
        triggerConfetti();
    }

    function closeBadgePopup() {
        document.getElementById('badgePopup').classList.remove('show');
    }

    function triggerConfetti() {
        const colors = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];
        const container = document.createElement('div');
        container.className = 'confetti';
        document.body.appendChild(container);

        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.style.cssText = `
                position: absolute;
                width: 10px;
                height: 10px;
                background: ${colors[Math.floor(Math.random() * colors.length)]};
                left: ${Math.random() * 100}%;
                top: -10px;
                border-radius: 50%;
                animation: confettiFall ${2 + Math.random() * 2}s linear forwards;
            `;
            container.appendChild(confetti);
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes confettiFall {
                to { top: 100vh; transform: rotate(${Math.random() * 720}deg); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        setTimeout(() => { container.remove(); style.remove(); }, 4000);
    }

    // ============ INIT ============
    document.addEventListener('DOMContentLoaded', init);

    // Close modal on backdrop click
    document.getElementById('settingsModal').addEventListener('click', e => {
        if (e.target === e.currentTarget) closeSettings();
    });
    </script>
</body>
</html>
